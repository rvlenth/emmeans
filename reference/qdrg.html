<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Quick and dirty reference grid — qdrg • emmeans</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Quick and dirty reference grid — qdrg"><meta name="description" content="This function may make it possible to compute a reference grid for a model
object that is otherwise not supported."><meta property="og:description" content="This function may make it possible to compute a reference grid for a model
object that is otherwise not supported."><meta property="og:image" content="https://rvlenth.github.io/emmeans/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">emmeans</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.11.2-80001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/AQuickStart.html">Quick start guide for **emmeans**</a></li>
    <li><a class="dropdown-item" href="../articles/basics.html">Basics of estimated marginal means</a></li>
    <li><a class="dropdown-item" href="../articles/comparisons.html">Comparisons and contrasts in emmeans</a></li>
    <li><a class="dropdown-item" href="../articles/confidence-intervals.html">Confidence intervals and tests in emmeans</a></li>
    <li><a class="dropdown-item" href="../articles/FAQs.html">FAQs for emmeans</a></li>
    <li><a class="dropdown-item" href="../articles/interactions.html">Interaction analysis in emmeans</a></li>
    <li><a class="dropdown-item" href="../articles/messy-data.html">Working with messy data</a></li>
    <li><a class="dropdown-item" href="../articles/models.html">Models supported by emmeans</a></li>
    <li><a class="dropdown-item" href="../articles/predictions.html">Prediction in **emmeans**</a></li>
    <li><a class="dropdown-item" href="../articles/re-engineering-clds.html">Re-engineering CLDs</a></li>
    <li><a class="dropdown-item" href="../articles/sophisticated.html">Sophisticated models in emmeans</a></li>
    <li><a class="dropdown-item" href="../articles/transformations.html">Transformations and link functions in emmeans</a></li>
    <li><a class="dropdown-item" href="../articles/utilities.html">Utilities and options for emmeans</a></li>
    <li><a class="dropdown-item" href="../articles/vignette-topics.html">Index of vignette topics</a></li>
    <li><a class="dropdown-item" href="../articles/xplanations.html">Explanations supplement</a></li>
    <li><a class="dropdown-item" href="../articles/xtending.html">For developers: Extending **emmeans**</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rvlenth/emmeans/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Quick and dirty reference grid</h1>
      <small class="dont-index">Source: <a href="https://github.com/rvlenth/emmeans/blob/master/R/qdrg.R" class="external-link"><code>R/qdrg.R</code></a></small>
      <div class="d-none name"><code>qdrg.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function may make it possible to compute a reference grid for a model
object that is otherwise not supported.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">qdrg</span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span>, <span class="va">coef</span>, <span class="va">vcov</span>, <span class="va">df</span>, <span class="va">mcmc</span>, <span class="va">object</span>, <span class="va">subset</span>, <span class="va">weights</span>, <span class="va">contrasts</span>,</span>
<span>  <span class="va">link</span>, <span class="va">qr</span>, <span class="va">ordinal</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>Formula for the fixed effects</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Dataset containing the variables in the model</p></dd>


<dt id="arg-coef">coef<a class="anchor" aria-label="anchor" href="#arg-coef"></a></dt>
<dd><p>Fixed-effect regression coefficients (must conform to formula)</p></dd>


<dt id="arg-vcov">vcov<a class="anchor" aria-label="anchor" href="#arg-vcov"></a></dt>
<dd><p>Variance-covariance matrix of the fixed effects</p></dd>


<dt id="arg-df">df<a class="anchor" aria-label="anchor" href="#arg-df"></a></dt>
<dd><p>Error degrees of freedom</p></dd>


<dt id="arg-mcmc">mcmc<a class="anchor" aria-label="anchor" href="#arg-mcmc"></a></dt>
<dd><p>Posterior sample of fixed-effect coefficients</p></dd>


<dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>Optional model object. <em>This rarely works!</em>;
but if provided, we try to set
other arguments based on an expectation that `object` has a similar
structure to `lm` objects. See Details.</p></dd>


<dt id="arg-subset">subset<a class="anchor" aria-label="anchor" href="#arg-subset"></a></dt>
<dd><p>Subset of <code>data</code> used in fitting the model</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>Weights used in fitting the model</p></dd>


<dt id="arg-contrasts">contrasts<a class="anchor" aria-label="anchor" href="#arg-contrasts"></a></dt>
<dd><p>List of contrasts specified in fitting the model</p></dd>


<dt id="arg-link">link<a class="anchor" aria-label="anchor" href="#arg-link"></a></dt>
<dd><p>Link function (character or list) used, if a generalized linear model.
(Note: response transformations are auto-detected from <code>formula</code>)</p></dd>


<dt id="arg-qr">qr<a class="anchor" aria-label="anchor" href="#arg-qr"></a></dt>
<dd><p>QR decomposition of the model matrix; used only if there are <code>NA</code>s
in <code>coef</code>.</p></dd>


<dt id="arg-ordinal">ordinal<a class="anchor" aria-label="anchor" href="#arg-ordinal"></a></dt>
<dd><p><code>list</code> with elements <code>dim</code> and <code>mode</code>.
<code>ordinal$dim</code> (integer) is the number of levels in an ordinal response. If
<code>ordinal</code> is provided, the intercept terms are modified appropriate to predicting
an ordinal response, as described in <code><a href="../articles/models.html">vignette("models")</a></code>, Section O,
using <code>ordinal$mode</code> as the <code>mode</code> argument (if not
provided, <code>"latent"</code> is assumed).
(All modes are supported except `scale`)
For this to work, we expect
the first <code>ordinal$dim - 1</code> elements of <code>coef</code> to be the
estimated threshold parameters, followed by the coefficients for the
linear predictor.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Optional arguments passed to <code><a href="ref_grid.html">ref_grid</a></code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An <code>emmGrid</code> object constructed from the arguments</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Usually, you need to provide either <code>object</code>; or
<code>formula</code>, <code>coef</code>, <code>vcov</code>, <code>data</code>, and perhaps other
parameters. It is usually fairly straightforward to figure out how to get
these from the model <code>object</code>; see the documentation for the model class that
was fitted. Sometimes one or more of these quantities contains extra parameters,
and if so, you may need to subset them to make everything conformable. For a given <code>formula</code> and <code>data</code>,
you can find out what is needed via <code>colnames(model.matrix(formula, data))</code>.
(However, for an ordinal model, we expect the first <code>ordinal.dim - 1</code> coefficients
to replace <code>(Intercept)</code>. And for a multivariate model, we expect <code>coef</code>
to be a matrix with these row names, and <code>vcov</code> to have as many rows and columns as
the total number of elements of <code>coef</code>.)</p>
<p>If your model object follows fairly closely the conventions of an <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></code>
or <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></code>object, you may be able to get by providing the model as <code>object</code>,
and perhaps some other parameters to override the defaults.
When <code>object</code> is specified, it is used as detailed below to try to obtain the
other arguments. The user should ensure that the defaults
shown below do indeed work.
The default values for the arguments are as follows:</p><ul><li><p><code>formula</code>: <code>formula(object)</code></p></li>
<li><p><code>data</code>: <code>recover_data.lm(object)</code> is tried, and if an error is thrown,
    we also check <code>object$data</code>.</p></li>
<li><p><code>coef</code>: <code>coef(object)</code></p></li>
<li><p><code>vcov</code>: <code>vcov(object)</code></p></li>
<li><p><code>df</code>: Set to <code>Inf</code> if not available in <code>df.residual(object)</code></p></li>
<li><p><code>mcmc</code>: <code>object$sample</code></p></li>
<li><p><code>subset</code>: <code>NULL</code> (so that all observations in <code>data</code> are used)</p></li>
<li><p><code>contrasts</code>: <code>object$contrasts</code></p></li>
</ul><p>The functions <code>qdrg</code> and <code>emmobj</code> are close cousins, in that
they both produce <code>emmGrid</code> objects. When starting with summary
statistics for an existing grid, <code>emmobj</code> is more useful, while
<code>qdrg</code> is more useful when starting from a fitted model.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>For backwards compatibility, an argument <code>ordinal.dim</code> is invisibly
supported as part of <code>...</code>, and if present, sets
<code>ordinal = list(dim = ordinal.dim, mode = "latent")</code></p>
    </div>
    <div class="section level2">
    <h2 id="rank-deficiencies">Rank deficiencies<a class="anchor" aria-label="anchor" href="#rank-deficiencies"></a></h2>


<p>Different model-fitting packages take different approaches when the model
matrix is singular, but <code>qdrg</code> tries to reconcile them by comparing the
linear functions created by <code>formula</code> to <code>coefs</code> and <code>vcov</code>.
We may then use the <span class="pkg">estimability</span> package to determine what quantities
are estimable. For reconciling to work properly, <code>coef</code> should be named
and <code>vcov</code> should have dimnames. To disable this name-matching
action, remove the names from <code>coef</code>, e.g., by calling <code><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname()</a></code>.
No reconciliation is attempted in multivariate-response cases. For more
details on estimability, see the documentation in the <span class="pkg">estimability</span>
package.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="emmobj.html">emmobj</a></code> for an alternative way to construct an <code>emmGrid</code>.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># In these examples, use emm_example(..., list = TRUE) # to see just the code</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va">biglm</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-in"><span>    <span class="fu"><a href="emm_example.html">emm_example</a></span><span class="op">(</span><span class="st">"qdrg-biglm"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> --- Running code from 'system.file("extexamples", "qdrg-biglm.R", package = "emmeans")'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; bigmod &lt;- biglm(log(conc) ~ source + factor(percent), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +     data = pigs)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; rg1 &lt;- qdrg(log(conc) ~ source + factor(percent), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +     data = pigs, coef = coef(bigmod), vcov = vcov(bigmod), df = bigmod$df.residual)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; emmeans(rg1, "source", type = "response")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  source response   SE  df asymp.LCL asymp.UCL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  fish       29.8 1.09 Inf      27.7      32.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  soy        39.1 1.47 Inf      36.4      42.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  skim       44.6 1.75 Inf      41.2      48.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Results are averaged over the levels of: percent </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Confidence level used: 0.95 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intervals are back-transformed from the log scale </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span>    </span></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va">coda</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/" class="external-link">lme4</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-in"><span>    <span class="fu"><a href="emm_example.html">emm_example</a></span><span class="op">(</span><span class="st">"qdrg-coda"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘lme4’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following object is masked from ‘package:nlme’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     lmList</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> --- Running code from 'system.file("extexamples", "qdrg-coda.R", package = "emmeans")'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; post &lt;- readRDS(system.file("extdata", "cbpplist", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +     package = "emmeans"))$post.beta</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; rg2 &lt;- qdrg(~size + period, data = lme4::cbpp, mcmc = post, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +     link = "logit")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; summary(rg2, type = "response")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  size period response lower.HPD upper.HPD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    15 1        0.1930    0.1214     0.288</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    15 2        0.0836    0.0398     0.137</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    15 3        0.0748    0.0369     0.129</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    15 4        0.0489    0.0138     0.101</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Point estimate displayed: median </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Results are back-transformed from the logit scale </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> HPD interval probability: 0.95 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span>    </span></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/runehaubo/ordinal" class="external-link">ordinal</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-in"><span>    <span class="fu"><a href="emm_example.html">emm_example</a></span><span class="op">(</span><span class="st">"qdrg-ordinal"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> --- Running code from 'system.file("extexamples", "qdrg-ordinal.R", package = "emmeans")'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; wine.clm &lt;- clm(rating ~ temp * contact, data = wine)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; ref_grid(wine.clm)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 'emmGrid' object with variables:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     temp = cold, warm</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     contact = no, yes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; qdrg(object = wine.clm, ordinal.dim = 5)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 'emmGrid' object with variables:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     temp = cold, warm</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     contact = no, yes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Russell V. Lenth.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

