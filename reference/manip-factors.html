<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="These functions manipulate the levels of factors comprising a reference
grid by combining factor levels, splitting a factor's levels into 
combinations of newly-defined factors, creating a grouping factor in which 
factor(s) levels are nested, or permuting the order of levels of a factor"><title>Manipulate factors in a reference grid — comb_facs • emmeans</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Manipulate factors in a reference grid — comb_facs"><meta property="og:description" content="These functions manipulate the levels of factors comprising a reference
grid by combining factor levels, splitting a factor's levels into 
combinations of newly-defined factors, creating a grouping factor in which 
factor(s) levels are nested, or permuting the order of levels of a factor"><meta property="og:image" content="https://rvlenth.github.io/emmeans/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">emmeans</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.10.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/AQuickStart.html">Quick start guide for **emmeans**</a>
    <a class="dropdown-item" href="../articles/basics.html">Basics of estimated marginal means</a>
    <a class="dropdown-item" href="../articles/comparisons.html">Comparisons and contrasts in emmeans</a>
    <a class="dropdown-item" href="../articles/confidence-intervals.html">Confidence intervals and tests in emmeans</a>
    <a class="dropdown-item" href="../articles/FAQs.html">FAQs for emmeans</a>
    <a class="dropdown-item" href="../articles/interactions.html">Interaction analysis in emmeans</a>
    <a class="dropdown-item" href="../articles/messy-data.html">Working with messy data</a>
    <a class="dropdown-item" href="../articles/models.html">Models supported by emmeans</a>
    <a class="dropdown-item" href="../articles/predictions.html">Prediction in **emmeans**</a>
    <a class="dropdown-item" href="../articles/re-engineering-clds.html">Re-engineering CLDs</a>
    <a class="dropdown-item" href="../articles/sophisticated.html">Sophisticated models in emmeans</a>
    <a class="dropdown-item" href="../articles/transformations.html">Transformations and link functions in emmeans</a>
    <a class="dropdown-item" href="../articles/utilities.html">Utilities and options for emmeans</a>
    <a class="dropdown-item" href="../articles/vignette-topics.html">Index of vignette topics</a>
    <a class="dropdown-item" href="../articles/xplanations.html">Explanations supplement</a>
    <a class="dropdown-item" href="../articles/xtending.html">For developers: Extending **emmeans**</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/rvlenth/emmeans/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Manipulate factors in a reference grid</h1>
      <small class="dont-index">Source: <a href="https://github.com/rvlenth/emmeans/blob/HEAD/R/factors.R" class="external-link"><code>R/factors.R</code></a></small>
      <div class="d-none name"><code>manip-factors.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>These functions manipulate the levels of factors comprising a reference
grid by combining factor levels, splitting a factor's levels into 
combinations of newly-defined factors, creating a grouping factor in which 
factor(s) levels are nested, or permuting the order of levels of a factor</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">comb_facs</span><span class="op">(</span><span class="va">object</span>, <span class="va">facs</span>, newname <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">facs</span>, collapse <span class="op">=</span> <span class="st">"."</span><span class="op">)</span>,</span>
<span>  drop <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">split_fac</span><span class="op">(</span><span class="va">object</span>, <span class="va">fac</span>, <span class="va">newfacs</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">add_grouping</span><span class="op">(</span><span class="va">object</span>, <span class="va">newname</span>, <span class="va">refname</span>, <span class="va">newlevs</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">permute_levels</span><span class="op">(</span><span class="va">object</span>, <span class="va">fac</span>, <span class="va">pos</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>object</dt>
<dd><p>An object of class <code>emmGrid</code></p></dd>


<dt>facs</dt>
<dd><p>Character vector. The names of the factors to combine</p></dd>


<dt>newname</dt>
<dd><p>Character name of grouping factor to add (different from any
existing factor in the grid)</p></dd>


<dt>drop</dt>
<dd><p>Logical value. If <code>TRUE</code>, any levels of the new factor that 
are dropped if all occurrences in the newly reconstructed object have 
weight zero. If <code>FALSE</code>, all levels are retained. 
(This argument is ignored if there is no <code>.wgt.</code> column
in <code>object@grid</code>.)</p></dd>


<dt>...</dt>
<dd><p>arguments passed to other methods</p></dd>


<dt>fac</dt>
<dd><p>The name of a factor that is part of the grid in <code>object</code></p></dd>


<dt>newfacs</dt>
<dd><p>A named list with the names of new factors
and their levels. The names must not already exist in the object,
and the product of the lengths of the levels must equal the number
of levels of <code>fac</code>.</p></dd>


<dt>refname</dt>
<dd><p>Character name(s) of the reference factor(s)</p></dd>


<dt>newlevs</dt>
<dd><p>Character vector or factor of the same length as that of the (combined) levels for 
<code>refname</code>. The grouping factor <code>newname</code> will have the unique
values of <code>newlevs</code> as its levels. The order of levels in <code>newlevs</code>
is the same as the order of the level combinations produced by 
<code><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></code> applied to the levels of <code>refname</code> -- that is, the
first factor's levels change the fastest and the last one's vary the slowest.</p></dd>


<dt>pos</dt>
<dd><p>Integer vector consisting of some permutation of the sequence
<code>1:k</code>, where <code>k</code> is the number of levels of <code>fac</code>.
This determines which position each level of <code>fac</code> will occupy
after the levels are permuted; thus, if the
levels of <code>fac</code> are <code>A,B,C,D</code>, and <code>pos = c(3,1,2,4)</code>, 
then the permuted levels will be <code>B,C,A,D</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A modified object of class <code>emmGrid</code></p>


    </div>
    <div class="section level2">
    <h2 id="the-comb-facs-function">The <code>comb_facs</code> function<a class="anchor" aria-label="anchor" href="#the-comb-facs-function"></a></h2>
    

<p><code>comb_facs</code> combines the levels of factors into a single factor
in the reference grid (similar to <code><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></code>). This new factor
replaces the factors that comprise it.</p>
<p><em>Additional note:</em>
The choice of whether to drop levels or not can make a profound difference.
If the goal is to combine factors for use in <code>joint_tests</code>, we advise <em>against</em> 
<code>drop = TRUE</code> because that might change the weights used in deriving marginal means.
If combining factors in a nested structure, dropping unused cases can considerably reduce 
the storage required.</p>
    </div>
    <div class="section level2">
    <h2 id="the-split-fac-function">The <code>split_fac</code> function<a class="anchor" aria-label="anchor" href="#the-split-fac-function"></a></h2>
    

<p>The levels in <code>newfacs</code> are expanded via <code><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></code> into
combinations of levels, and the factor <code>fac</code> is replaced by those 
factor combinations. Unlike <code>add_grouping</code>, this creates a crossed, 
rather than a nested structure. Note that the order of factor combinations
is systematic with the levels of first factor in <code>newfacs</code> varying 
the fastest; and those factor combinations are assigned respectively
to the levels of <code>fac</code> as displayed in <code>str(object)</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="the-add-grouping-function">The <code>add_grouping</code> function<a class="anchor" aria-label="anchor" href="#the-add-grouping-function"></a></h2>
    

<p>This function adds a grouping factor to an existing reference grid or other 
<code>emmGrid</code> object, such that the levels of one or more existing factors (call them the
reference factors) are mapped to a smaller number of levels of the new
grouping factor. The reference factors are then nested in a 
new grouping factor named <code>newname</code>, and a new nesting structure
<code>refname %in% newname</code>.
This facilitates obtaining marginal means of the grouping factor, and 
contrasts thereof.</p>

<p><em>Additional notes:</em> By default, the levels of <code>newname</code> will be ordered
  alphabetically. To dictate a different ordering of levels, supply 
  <code>newlevs</code> as a <code>factor</code> having its levels in the desired order.</p>  
<p>When <code>refname</code> specifies more than one factor, this can
  fundamentally (and permanently) change what is meant by the levels of those
  individual factors. For instance, in the <code>gwrg</code> example below, there
  are two levels of <code>wool</code> nested in each <code>prod</code>; and that implies
  that we now regard these as four different kinds of wool. Similarly, there
  are five different tensions (L, M, H in prod 1, and L, M in prod 2).</p>
    </div>
    <div class="section level2">
    <h2 id="the-permute-levels-function">The <code>permute_levels</code> function<a class="anchor" aria-label="anchor" href="#the-permute-levels-function"></a></h2>
    

<p>This function permutes the levels of <code>fac</code>. The returned object
has the same factors, same <code>by</code> variables, but with the levels
of <code>fac</code> permuted. 
The order of the columns in <code>object@grid</code> may be altered.</p>
<p>NOTE: <code>fac</code> must not be nested in another factor. <code>permute_levels</code> 
throws an error when <code>fac</code> is nested.</p>
<p>NOTE: Permuting the levels of a numeric predictor is tricky. For example,
if you want to display the new ordering of levels in <code><a href="emmip.html">emmip()</a></code>,
you must add the arguments <code>style = "factor"</code> and <code>nesting.order = TRUE</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">mtcars.lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">vs</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">gear</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">v.c.g</span> <span class="op">&lt;-</span> <span class="fu"><a href="ref_grid.html">ref_grid</a></span><span class="op">(</span><span class="va">mtcars.lm</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  vs cyl gear prediction    SE df</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   4    3       21.7 4.416 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   4    3       21.5 3.420 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   6    3       19.9 3.694 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   6    3       19.8 2.418 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   8    3       15.1 0.987 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   8    3       14.8 2.962 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   4    4       27.1 3.043 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   4    4       26.9 1.209 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   6    4       19.9 2.208 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   6    4       19.6 2.208 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   8    4     nonEst    NA NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   8    4     nonEst    NA NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   4    5       28.3 2.793 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   4    5       28.1 2.793 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   6    5       19.7 3.420 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   6    5       19.5 4.416 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   8    5       15.4 2.418 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   8    5       15.2 3.694 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="op">(</span><span class="va">v.cg</span> <span class="op">&lt;-</span> <span class="fu">comb_facs</span><span class="op">(</span><span class="va">v.c.g</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cyl"</span>, <span class="st">"gear"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  vs cyl.gear prediction    SE df</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0 4:3            21.7 4.416 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1 4:3            21.5 3.420 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0 6:3            19.9 3.694 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1 6:3            19.8 2.418 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0 8:3            15.1 0.987 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1 8:3            14.8 2.962 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0 4:4            27.1 3.043 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1 4:4            26.9 1.209 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0 6:4            19.9 2.208 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1 6:4            19.6 2.208 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0 8:4          nonEst    NA NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1 8:4          nonEst    NA NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0 4:5            28.3 2.793 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1 4:5            28.1 2.793 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0 6:5            19.7 3.420 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1 6:5            19.5 4.416 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0 8:5            15.4 2.418 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1 8:5            15.2 3.694 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span><span class="co"># One use is obtaining a single test for the joint contributions of two factors:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="joint_tests.html">joint_tests</a></span><span class="op">(</span><span class="va">v.c.g</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  model term   df1 df2 F.ratio p.value note</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  vs             1  23   0.005  0.9435     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  cyl            1  23   6.570  0.0174    e</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  gear           1  23   0.755  0.3939    e</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  cyl:gear       3  23   0.681  0.5725    e</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  (confounded)   2  23  26.980  &lt;.0001     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> e: df1 reduced due to non-estimability </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="joint_tests.html">joint_tests</a></span><span class="op">(</span><span class="va">v.cg</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  model term df1 df2 F.ratio p.value note</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  vs           1  23   0.005  0.9435     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  cyl.gear     7  23   4.402  0.0031    e</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> e: df1 reduced due to non-estimability </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># undo the 'comb_facs' operation:</span></span></span>
<span class="r-in"><span><span class="fu">split_fac</span><span class="op">(</span><span class="va">v.cg</span>, <span class="st">"cyl.gear"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cyl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">8</span><span class="op">)</span>, gear <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  vs cyl gear cyl.gear prediction    SE df</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   4    3 4:3            21.7 4.416 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   4    3 4:3            21.5 3.420 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   6    3 6:3            19.9 3.694 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   6    3 6:3            19.8 2.418 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   8    3 8:3            15.1 0.987 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   8    3 8:3            14.8 2.962 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   4    4 4:4            27.1 3.043 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   4    4 4:4            26.9 1.209 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   6    4 6:4            19.9 2.208 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   6    4 6:4            19.6 2.208 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   8    4 8:4          nonEst    NA NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   8    4 8:4          nonEst    NA NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   4    5 4:5            28.3 2.793 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   4    5 4:5            28.1 2.793 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   6    5 6:5            19.7 3.420 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   6    5 6:5            19.5 4.416 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   8    5 8:5            15.4 2.418 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   8    5 8:5            15.2 3.694 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">IS.glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">spray</span>, data <span class="op">=</span> <span class="va">InsectSprays</span>, family <span class="op">=</span> <span class="va">poisson</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">IS.emm</span> <span class="op">&lt;-</span> <span class="fu"><a href="emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">IS.glm</span>, <span class="st">"spray"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">IS.new</span> <span class="op">&lt;-</span> <span class="fu">split_fac</span><span class="op">(</span><span class="va">IS.emm</span>, <span class="st">"spray"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"low"</span>, <span class="st">"med"</span>, <span class="st">"hi"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">IS.new</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 'emmGrid' object with variables:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     A = 1, 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     B = low, med, hi</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Transformation: “log” </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fiber.lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">strength</span> <span class="op">~</span> <span class="va">diameter</span> <span class="op">+</span> <span class="va">machine</span>, data <span class="op">=</span> <span class="va">fiber</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">(</span> <span class="va">frg</span> <span class="op">&lt;-</span> <span class="fu"><a href="ref_grid.html">ref_grid</a></span><span class="op">(</span><span class="va">fiber.lm</span><span class="op">)</span> <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  diameter machine prediction    SE df</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      24.1 A             40.4 0.724 11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      24.1 B             41.4 0.744 11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      24.1 C             38.8 0.788 11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Suppose the machines are two different brands</span></span></span>
<span class="r-in"><span><span class="va">brands</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FiberPro"</span>, <span class="st">"FiberPro"</span>, <span class="st">"Acme"</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FiberPro"</span>, <span class="st">"Acme"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">(</span> <span class="va">gfrg</span> <span class="op">&lt;-</span> <span class="fu">add_grouping</span><span class="op">(</span><span class="va">frg</span>, <span class="st">"brand"</span>, <span class="st">"machine"</span>, <span class="va">brands</span><span class="op">)</span> <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  diameter machine brand    prediction    SE df</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      24.1 A       FiberPro       40.4 0.724 11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      24.1 B       FiberPro       41.4 0.744 11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      24.1 C       Acme           38.8 0.788 11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">gfrg</span>, <span class="st">"machine"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  machine brand    emmean    SE df lower.CL upper.CL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  A       FiberPro   40.4 0.724 11     38.8     42.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  B       FiberPro   41.4 0.744 11     39.8     43.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  C       Acme       38.8 0.788 11     37.1     40.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Confidence level used: 0.95 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">gfrg</span>, <span class="st">"brand"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  brand    emmean    SE df lower.CL upper.CL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  FiberPro   40.9 0.531 11     39.7     42.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Acme       38.8 0.788 11     37.1     40.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Results are averaged over the levels of: machine </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Confidence level used: 0.95 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### More than one reference factor</span></span></span>
<span class="r-in"><span><span class="va">warp.lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">breaks</span> <span class="op">~</span> <span class="va">wool</span> <span class="op">*</span> <span class="va">tension</span>, data <span class="op">=</span> <span class="va">warpbreaks</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">gwrg</span> <span class="op">&lt;-</span> <span class="fu">add_grouping</span><span class="op">(</span><span class="fu"><a href="ref_grid.html">ref_grid</a></span><span class="op">(</span><span class="va">warp.lm</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>    <span class="st">"prod"</span>,  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tension"</span>, <span class="st">"wool"</span><span class="op">)</span>,  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span>,  <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="co"># level combinations:         LA MA HA  LB MB HB</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">gwrg</span>, <span class="op">~</span> <span class="va">wool</span> <span class="op">*</span> <span class="va">tension</span><span class="op">)</span>   <span class="co"># some NAs due to impossible combinations</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  wool tension prod emmean   SE df lower.CL upper.CL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  A    L       1    nonEst   NA NA       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  B    L       1      28.2 3.65 48     20.9     35.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  A    M       1      24.0 3.65 48     16.7     31.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  B    M       1    nonEst   NA NA       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  A    H       1      24.6 3.65 48     17.2     31.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  B    H       1      18.8 3.65 48     11.4     26.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  A    L       2      44.6 3.65 48     37.2     51.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  B    L       2    nonEst   NA NA       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  A    M       2    nonEst   NA NA       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  B    M       2      28.8 3.65 48     21.4     36.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Confidence level used: 0.95 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">gwrg</span>, <span class="st">"prod"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  prod emmean   SE df lower.CL upper.CL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1      24.6 1.92 48     20.8     28.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2      36.7 2.58 48     31.5     41.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Results are averaged over the levels of: wool, tension </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Confidence level used: 0.95 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">v.c.g</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 'emmGrid' object with variables:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     vs = 0, 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     cyl = 4, 6, 8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     gear = 3, 4, 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Some things are non-estimable (null space dim = 1)</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu">permute_levels</span><span class="op">(</span><span class="va">v.c.g</span>, <span class="st">"cyl"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 'emmGrid' object with variables:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     vs = 0, 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     cyl = 8, 4, 6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     gear = 3, 4, 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Some things are non-estimable (null space dim = 1)</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Russell V. Lenth.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

