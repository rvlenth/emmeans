<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Manipulate factors in a reference grid — comb_facs • emmeans</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Manipulate factors in a reference grid — comb_facs"><meta name="description" content="These functions manipulate the levels of factors comprising a reference
grid by combining factor levels, splitting a factor's levels into
combinations of newly-defined factors, creating a grouping factor in which
factor(s) levels are nested, or permuting the order of levels of a factor"><meta property="og:description" content="These functions manipulate the levels of factors comprising a reference
grid by combining factor levels, splitting a factor's levels into
combinations of newly-defined factors, creating a grouping factor in which
factor(s) levels are nested, or permuting the order of levels of a factor"><meta property="og:image" content="https://rvlenth.github.io/emmeans/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">emmeans</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.11.2-80001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/AQuickStart.html">Quick start guide for **emmeans**</a></li>
    <li><a class="dropdown-item" href="../articles/basics.html">Basics of estimated marginal means</a></li>
    <li><a class="dropdown-item" href="../articles/comparisons.html">Comparisons and contrasts in emmeans</a></li>
    <li><a class="dropdown-item" href="../articles/confidence-intervals.html">Confidence intervals and tests in emmeans</a></li>
    <li><a class="dropdown-item" href="../articles/FAQs.html">FAQs for emmeans</a></li>
    <li><a class="dropdown-item" href="../articles/interactions.html">Interaction analysis in emmeans</a></li>
    <li><a class="dropdown-item" href="../articles/messy-data.html">Working with messy data</a></li>
    <li><a class="dropdown-item" href="../articles/models.html">Models supported by emmeans</a></li>
    <li><a class="dropdown-item" href="../articles/predictions.html">Prediction in **emmeans**</a></li>
    <li><a class="dropdown-item" href="../articles/re-engineering-clds.html">Re-engineering CLDs</a></li>
    <li><a class="dropdown-item" href="../articles/sophisticated.html">Sophisticated models in emmeans</a></li>
    <li><a class="dropdown-item" href="../articles/transformations.html">Transformations and link functions in emmeans</a></li>
    <li><a class="dropdown-item" href="../articles/utilities.html">Utilities and options for emmeans</a></li>
    <li><a class="dropdown-item" href="../articles/vignette-topics.html">Index of vignette topics</a></li>
    <li><a class="dropdown-item" href="../articles/xplanations.html">Explanations supplement</a></li>
    <li><a class="dropdown-item" href="../articles/xtending.html">For developers: Extending **emmeans**</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rvlenth/emmeans/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Manipulate factors in a reference grid</h1>
      <small class="dont-index">Source: <a href="https://github.com/rvlenth/emmeans/blob/master/R/factors.R" class="external-link"><code>R/factors.R</code></a></small>
      <div class="d-none name"><code>manip-factors.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>These functions manipulate the levels of factors comprising a reference
grid by combining factor levels, splitting a factor's levels into
combinations of newly-defined factors, creating a grouping factor in which
factor(s) levels are nested, or permuting the order of levels of a factor</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">comb_facs</span><span class="op">(</span><span class="va">object</span>, <span class="va">facs</span>, newname <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">facs</span>, collapse <span class="op">=</span> <span class="st">"."</span><span class="op">)</span>,</span>
<span>  drop <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">split_fac</span><span class="op">(</span><span class="va">object</span>, <span class="va">fac</span>, <span class="va">newfacs</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">add_grouping</span><span class="op">(</span><span class="va">object</span>, <span class="va">newname</span>, <span class="va">refname</span>, <span class="va">newlevs</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">add_submodels</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span>, newname <span class="op">=</span> <span class="st">"model"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">permute_levels</span><span class="op">(</span><span class="va">object</span>, <span class="va">fac</span>, <span class="va">pos</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>An object of class <code>emmGrid</code></p></dd>


<dt id="arg-facs">facs<a class="anchor" aria-label="anchor" href="#arg-facs"></a></dt>
<dd><p>Character vector. The names of the factors to combine</p></dd>


<dt id="arg-newname">newname<a class="anchor" aria-label="anchor" href="#arg-newname"></a></dt>
<dd><p>Character name of grouping factor to add (different from any
existing factor in the grid)</p></dd>


<dt id="arg-drop">drop<a class="anchor" aria-label="anchor" href="#arg-drop"></a></dt>
<dd><p>Logical value. If <code>TRUE</code>, any levels of the new factor that
are dropped if all occurrences in the newly reconstructed object have
weight zero. If <code>FALSE</code>, all levels are retained.
(This argument is ignored if there is no <code>.wgt.</code> column
in <code>object@grid</code>.)</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>arguments passed to other methods</p></dd>


<dt id="arg-fac">fac<a class="anchor" aria-label="anchor" href="#arg-fac"></a></dt>
<dd><p>The name of a factor that is part of the grid in <code>object</code></p></dd>


<dt id="arg-newfacs">newfacs<a class="anchor" aria-label="anchor" href="#arg-newfacs"></a></dt>
<dd><p>A named list with the names of new factors
and their levels. The names must not already exist in the object,
and the product of the lengths of the levels must equal the number
of levels of <code>fac</code>.</p></dd>


<dt id="arg-refname">refname<a class="anchor" aria-label="anchor" href="#arg-refname"></a></dt>
<dd><p>Character name(s) of the reference factor(s)</p></dd>


<dt id="arg-newlevs">newlevs<a class="anchor" aria-label="anchor" href="#arg-newlevs"></a></dt>
<dd><p>Character vector or factor of the same length as that of the (combined) levels for
<code>refname</code>. The grouping factor <code>newname</code> will have the unique
values of <code>newlevs</code> as its levels. The order of levels in <code>newlevs</code>
is the same as the order of the level combinations produced by
<code><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></code> applied to the levels of <code>refname</code> – that is, the
first factor's levels change the fastest and the last one's vary the slowest.</p></dd>


<dt id="arg-pos">pos<a class="anchor" aria-label="anchor" href="#arg-pos"></a></dt>
<dd><p>Integer vector consisting of some permutation of the sequence
<code>1:k</code>, where <code>k</code> is the number of levels of <code>fac</code>.
This determines which position each level of <code>fac</code> will occupy
after the levels are permuted; thus, if the
levels of <code>fac</code> are <code>A,B,C,D</code>, and <code>pos = c(3,1,2,4)</code>,
then the permuted levels will be <code>B,C,A,D</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A modified object of class <code>emmGrid</code></p>
    </div>
    <div class="section level2">
    <h2 id="the-comb-facs-function">The <code>comb_facs</code> function<a class="anchor" aria-label="anchor" href="#the-comb-facs-function"></a></h2>


<p><code>comb_facs</code> combines the levels of factors into a single factor
in the reference grid (similar to <code><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></code>). This new factor
replaces the factors that comprise it.</p>
<p><em>Additional note:</em>
The choice of whether to drop levels or not can make a profound difference.
If the goal is to combine factors for use in <code>joint_tests</code>, we advise <em>against</em>
<code>drop = TRUE</code> because that might change the weights used in deriving marginal means.
If combining factors in a nested structure, dropping unused cases can considerably reduce
the storage required.</p>
    </div>
    <div class="section level2">
    <h2 id="the-split-fac-function">The <code>split_fac</code> function<a class="anchor" aria-label="anchor" href="#the-split-fac-function"></a></h2>


<p>The levels in <code>newfacs</code> are expanded via <code><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></code> into
combinations of levels, and the factor <code>fac</code> is replaced by those
factor combinations. Unlike <code>add_grouping</code>, this creates a crossed,
rather than a nested structure. Note that the order of factor combinations
is systematic with the levels of first factor in <code>newfacs</code> varying
the fastest; and those factor combinations are assigned respectively
to the levels of <code>fac</code> as displayed in <code>str(object)</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="the-add-grouping-function">The <code>add_grouping</code> function<a class="anchor" aria-label="anchor" href="#the-add-grouping-function"></a></h2>


<p>This function adds a grouping factor to an existing reference grid or other
<code>emmGrid</code> object, such that the levels of one or more existing factors (call them the
reference factors) are mapped to a smaller number of levels of the new
grouping factor. The reference factors are then nested in a
new grouping factor named <code>newname</code>, and a new nesting structure
<code>refname %in% newname</code>.
This facilitates obtaining marginal means of the grouping factor, and
contrasts thereof.</p>

<p><em>Additional notes:</em> By default, the levels of <code>newname</code> will be ordered
  alphabetically. To dictate a different ordering of levels, supply
  <code>newlevs</code> as a <code>factor</code> having its levels in the desired order.</p>
<p>When <code>refname</code> specifies more than one factor, this can
  fundamentally (and permanently) change what is meant by the levels of those
  individual factors. For instance, in the <code>gwrg</code> example below, there
  are two levels of <code>wool</code> nested in each <code>prod</code>; and that implies
  that we now regard these as four different kinds of wool. Similarly, there
  are five different tensions (L, M, H in prod 1, and L, M in prod 2).</p>
    </div>
    <div class="section level2">
    <h2 id="the-add-submodels-function">The <code>add_submodels</code> function<a class="anchor" aria-label="anchor" href="#the-add-submodels-function"></a></h2>


<p>This function updates <code>object</code> with a named list of submodels specified in
<code>...</code>. These are <code>rbind</code>ed together and the corresponding rows
for each submodel are assigned a factor named <code>newname</code> with levels
equal to the names in <code>...</code>. This facilitates comparing estimates obtained
from different submodels. For this to work, the underlying model object must be of
a class supported by the <code>submodel</code> argument of <code><a href="update.emmGrid.html">update.emmGrid</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="the-permute-levels-function">The <code>permute_levels</code> function<a class="anchor" aria-label="anchor" href="#the-permute-levels-function"></a></h2>


<p>This function permutes the levels of <code>fac</code>. The returned object
has the same factors, same <code>by</code> variables, but with the levels
of <code>fac</code> permuted.
The order of the columns in <code>object@grid</code> may be altered.</p>
<p>NOTE: <code>fac</code> must not be nested in another factor. <code>permute_levels</code>
throws an error when <code>fac</code> is nested.</p>
<p>NOTE: Permuting the levels of a numeric predictor is tricky. For example,
if you want to display the new ordering of levels in <code><a href="emmip.html">emmip()</a></code>,
you must add the arguments <code>style = "factor"</code> and <code>nesting.order = TRUE</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">mtcars.lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">vs</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">gear</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">v.c.g</span> <span class="op">&lt;-</span> <span class="fu"><a href="ref_grid.html">ref_grid</a></span><span class="op">(</span><span class="va">mtcars.lm</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  vs cyl gear prediction    SE df</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   4    3       21.7 4.420 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   4    3       21.5 3.420 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   6    3       19.9 3.690 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   6    3       19.8 2.420 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   8    3       15.1 0.987 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   8    3       14.8 2.960 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   4    4       27.1 3.040 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   4    4       26.9 1.210 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   6    4       19.9 2.210 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   6    4       19.6 2.210 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   8    4     nonEst    NA NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   8    4     nonEst    NA NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   4    5       28.3 2.790 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   4    5       28.1 2.790 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   6    5       19.7 3.420 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   6    5       19.5 4.420 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   8    5       15.4 2.420 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   8    5       15.2 3.690 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="op">(</span><span class="va">v.cg</span> <span class="op">&lt;-</span> <span class="fu">comb_facs</span><span class="op">(</span><span class="va">v.c.g</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cyl"</span>, <span class="st">"gear"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  vs cyl.gear prediction    SE df</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0 4:3            21.7 4.420 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1 4:3            21.5 3.420 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0 6:3            19.9 3.690 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1 6:3            19.8 2.420 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0 8:3            15.1 0.987 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1 8:3            14.8 2.960 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0 4:4            27.1 3.040 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1 4:4            26.9 1.210 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0 6:4            19.9 2.210 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1 6:4            19.6 2.210 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0 8:4          nonEst    NA NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1 8:4          nonEst    NA NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0 4:5            28.3 2.790 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1 4:5            28.1 2.790 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0 6:5            19.7 3.420 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1 6:5            19.5 4.420 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0 8:5            15.4 2.420 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1 8:5            15.2 3.690 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span><span class="co"># One use is obtaining a single test for the joint contributions of two factors:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="joint_tests.html">joint_tests</a></span><span class="op">(</span><span class="va">v.c.g</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  model term   df1 df2 F.ratio p.value note</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  vs             1  23   0.005  0.9435     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  cyl            1  23   6.570  0.0174    e</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  gear           1  23   0.755  0.3939    e</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  cyl:gear       3  23   0.681  0.5725    e</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  (confounded)   2  23  26.980  &lt;.0001     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> e: df1 reduced due to non-estimability </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="joint_tests.html">joint_tests</a></span><span class="op">(</span><span class="va">v.cg</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  model term df1 df2 F.ratio p.value note</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  vs           1  23   0.005  0.9435     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  cyl.gear     7  23   4.402  0.0031    e</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> e: df1 reduced due to non-estimability </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># undo the 'comb_facs' operation:</span></span></span>
<span class="r-in"><span><span class="fu">split_fac</span><span class="op">(</span><span class="va">v.cg</span>, <span class="st">"cyl.gear"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cyl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">8</span><span class="op">)</span>, gear <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  vs cyl gear cyl.gear prediction    SE df</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   4    3 4:3            21.7 4.420 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   4    3 4:3            21.5 3.420 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   6    3 6:3            19.9 3.690 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   6    3 6:3            19.8 2.420 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   8    3 8:3            15.1 0.987 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   8    3 8:3            14.8 2.960 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   4    4 4:4            27.1 3.040 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   4    4 4:4            26.9 1.210 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   6    4 6:4            19.9 2.210 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   6    4 6:4            19.6 2.210 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   8    4 8:4          nonEst    NA NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   8    4 8:4          nonEst    NA NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   4    5 4:5            28.3 2.790 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   4    5 4:5            28.1 2.790 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   6    5 6:5            19.7 3.420 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   6    5 6:5            19.5 4.420 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0   8    5 8:5            15.4 2.420 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   8    5 8:5            15.2 3.690 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">IS.glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">spray</span>, data <span class="op">=</span> <span class="va">InsectSprays</span>, family <span class="op">=</span> <span class="va">poisson</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">IS.emm</span> <span class="op">&lt;-</span> <span class="fu"><a href="emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">IS.glm</span>, <span class="st">"spray"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">IS.new</span> <span class="op">&lt;-</span> <span class="fu">split_fac</span><span class="op">(</span><span class="va">IS.emm</span>, <span class="st">"spray"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"low"</span>, <span class="st">"med"</span>, <span class="st">"hi"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">IS.new</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 'emmGrid' object with variables:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     A = 1, 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     B = low, med, hi</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Transformation: “log” </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fiber.lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">strength</span> <span class="op">~</span> <span class="va">diameter</span> <span class="op">+</span> <span class="va">machine</span>, data <span class="op">=</span> <span class="va">fiber</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">(</span> <span class="va">frg</span> <span class="op">&lt;-</span> <span class="fu"><a href="ref_grid.html">ref_grid</a></span><span class="op">(</span><span class="va">fiber.lm</span><span class="op">)</span> <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  diameter machine prediction    SE df</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      24.1 A             40.4 0.724 11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      24.1 B             41.4 0.744 11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      24.1 C             38.8 0.788 11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Suppose the machines are two different brands</span></span></span>
<span class="r-in"><span><span class="va">brands</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FiberPro"</span>, <span class="st">"FiberPro"</span>, <span class="st">"Acme"</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FiberPro"</span>, <span class="st">"Acme"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">(</span> <span class="va">gfrg</span> <span class="op">&lt;-</span> <span class="fu">add_grouping</span><span class="op">(</span><span class="va">frg</span>, <span class="st">"brand"</span>, <span class="st">"machine"</span>, <span class="va">brands</span><span class="op">)</span> <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  diameter machine brand    prediction    SE df</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      24.1 A       FiberPro       40.4 0.724 11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      24.1 B       FiberPro       41.4 0.744 11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      24.1 C       Acme           38.8 0.788 11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">gfrg</span>, <span class="st">"machine"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  machine brand    emmean    SE df lower.CL upper.CL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  A       FiberPro   40.4 0.724 11     38.8     42.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  B       FiberPro   41.4 0.744 11     39.8     43.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  C       Acme       38.8 0.788 11     37.1     40.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Confidence level used: 0.95 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">gfrg</span>, <span class="st">"brand"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  brand    emmean    SE df lower.CL upper.CL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  FiberPro   40.9 0.531 11     39.7     42.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Acme       38.8 0.788 11     37.1     40.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Results are averaged over the levels of: machine </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Confidence level used: 0.95 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### More than one reference factor</span></span></span>
<span class="r-in"><span><span class="va">warp.lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">breaks</span> <span class="op">~</span> <span class="va">wool</span> <span class="op">*</span> <span class="va">tension</span>, data <span class="op">=</span> <span class="va">warpbreaks</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">gwrg</span> <span class="op">&lt;-</span> <span class="fu">add_grouping</span><span class="op">(</span><span class="fu"><a href="ref_grid.html">ref_grid</a></span><span class="op">(</span><span class="va">warp.lm</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>    <span class="st">"prod"</span>,  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tension"</span>, <span class="st">"wool"</span><span class="op">)</span>,  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span>,  <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="co"># level combinations:         LA MA HA  LB MB HB</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">gwrg</span>, <span class="op">~</span> <span class="va">wool</span> <span class="op">*</span> <span class="va">tension</span><span class="op">)</span>   <span class="co"># some NAs due to impossible combinations</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  wool tension prod emmean   SE df lower.CL upper.CL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  A    L       1    nonEst   NA NA       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  B    L       1      28.2 3.65 48     20.9     35.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  A    M       1      24.0 3.65 48     16.7     31.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  B    M       1    nonEst   NA NA       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  A    H       1      24.6 3.65 48     17.2     31.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  B    H       1      18.8 3.65 48     11.4     26.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  A    L       2      44.6 3.65 48     37.2     51.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  B    L       2    nonEst   NA NA       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  A    M       2    nonEst   NA NA       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  B    M       2      28.8 3.65 48     21.4     36.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Confidence level used: 0.95 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">gwrg</span>, <span class="st">"prod"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  prod emmean   SE df lower.CL upper.CL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1      24.6 1.92 48     20.8     28.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2      36.7 2.58 48     31.5     41.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Results are averaged over the levels of: wool, tension </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Confidence level used: 0.95 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Using 'add_submodels' to compare adjusted and unadjusted means</span></span></span>
<span class="r-in"><span><span class="va">fibint.lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">strength</span> <span class="op">~</span> <span class="va">machine</span> <span class="op">*</span> <span class="va">diameter</span>, data <span class="op">=</span> <span class="va">fiber</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fibsub</span> <span class="op">&lt;-</span> <span class="fu">add_submodels</span><span class="op">(</span><span class="fu"><a href="emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">fibint.lm</span>, <span class="st">"machine"</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>    full <span class="op">=</span> <span class="op">~</span> <span class="va">.</span>, additive <span class="op">=</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">machine</span><span class="op">:</span><span class="va">diameter</span>, unadj <span class="op">=</span> <span class="op">~</span> <span class="va">machine</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> NOTE: Results may be misleading due to involvement in interactions</span>
<span class="r-in"><span><span class="fu"><a href="emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">fibsub</span>, <span class="va">pairwise</span> <span class="op">~</span> <span class="va">model</span> <span class="op">|</span> <span class="va">machine</span>, adjust <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $emmeans</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> machine = A:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  model    emmean    SE df lower.CL upper.CL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  full       40.2 0.777  9     38.5     42.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  additive   40.4 0.760  9     38.7     42.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  unadj      41.4 0.749  9     39.7     43.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> machine = B:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  model    emmean    SE df lower.CL upper.CL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  full       41.6 0.858  9     39.7     43.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  additive   41.4 0.782  9     39.7     43.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  unadj      43.2 0.749  9     41.5     44.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> machine = C:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  model    emmean    SE df lower.CL upper.CL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  full       38.5 0.966  9     36.3     40.7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  additive   38.8 0.827  9     36.9     40.7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  unadj      36.0 0.749  9     34.3     37.7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Confidence level used: 0.95 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $contrasts</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> machine = A:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  contrast         estimate    SE df t.ratio p.value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  full - additive    -0.160 0.162  9  -0.987  0.3492</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  full - unadj       -1.178 0.207  9  -5.702  0.0003</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  additive - unadj   -1.018 0.128  9  -7.966  &lt;.0001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> machine = B:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  contrast         estimate    SE df t.ratio p.value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  full - additive     0.181 0.353  9   0.512  0.6209</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  full - unadj       -1.600 0.418  9  -3.830  0.0040</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  additive - unadj   -1.781 0.224  9  -7.966  &lt;.0001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> machine = C:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  contrast         estimate    SE df t.ratio p.value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  full - additive    -0.263 0.499  9  -0.528  0.6105</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  full - unadj        2.535 0.610  9   4.153  0.0025</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  additive - unadj    2.798 0.351  9   7.966  &lt;.0001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Permuting factor levels...</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">v.c.g</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 'emmGrid' object with variables:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     vs = 0, 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     cyl = 4, 6, 8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     gear = 3, 4, 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Some things are non-estimable (null space dim = 1)</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu">permute_levels</span><span class="op">(</span><span class="va">v.c.g</span>, <span class="st">"cyl"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 'emmGrid' object with variables:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     vs = 0, 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     cyl = 8, 4, 6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     gear = 3, 4, 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Some things are non-estimable (null space dim = 1)</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Russell V. Lenth.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

