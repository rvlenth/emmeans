<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="emmeans">
<title>Basics of estimated marginal means • emmeans</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Basics of estimated marginal means">
<meta property="og:description" content="emmeans">
<meta property="og:image" content="https://rvlenth.github.io/emmeans/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">emmeans</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.10.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/AQuickStart.html">Quick start guide for **emmeans**</a>
    <a class="dropdown-item" href="../articles/basics.html">Basics of estimated marginal means</a>
    <a class="dropdown-item" href="../articles/comparisons.html">Comparisons and contrasts in emmeans</a>
    <a class="dropdown-item" href="../articles/confidence-intervals.html">Confidence intervals and tests in emmeans</a>
    <a class="dropdown-item" href="../articles/FAQs.html">FAQs for emmeans</a>
    <a class="dropdown-item" href="../articles/interactions.html">Interaction analysis in emmeans</a>
    <a class="dropdown-item" href="../articles/messy-data.html">Working with messy data</a>
    <a class="dropdown-item" href="../articles/models.html">Models supported by emmeans</a>
    <a class="dropdown-item" href="../articles/predictions.html">Prediction in **emmeans**</a>
    <a class="dropdown-item" href="../articles/re-engineering-clds.html">Re-engineering CLDs</a>
    <a class="dropdown-item" href="../articles/sophisticated.html">Sophisticated models in emmeans</a>
    <a class="dropdown-item" href="../articles/transformations.html">Transformations and link functions in emmeans</a>
    <a class="dropdown-item" href="../articles/utilities.html">Utilities and options for emmeans</a>
    <a class="dropdown-item" href="../articles/vignette-topics.html">Index of vignette topics</a>
    <a class="dropdown-item" href="../articles/xplanations.html">Explanations supplement</a>
    <a class="dropdown-item" href="../articles/xtending.html">For developers: Extending **emmeans**</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/rvlenth/emmeans/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Basics of estimated marginal means</h1>
                        <h4 data-toc-skip class="author">emmeans
package, Version 1.10.3</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rvlenth/emmeans/blob/HEAD/vignettes/basics.Rmd" class="external-link"><code>vignettes/basics.Rmd</code></a></small>
      <div class="d-none name"><code>basics.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="contents">
<a href="#contents">Contents</a><a class="anchor" aria-label="anchor" href="#contents"></a>
</h2>
<ol style="list-style-type: decimal">
<li>
<a href="#found">Foundations</a>
<ol style="list-style-type: lower-alpha">
<li><a href="#exper">Emphasis on experimental data</a></li>
<li><a href="#models">Emphasis on models</a></li>
<li><a href="#pigs">Illustration: <code>pigs</code> experiment</a></li>
<li><a href="#emms">Estimated marginal means</a></li>
<li><a href="#refgrid">The reference grid, and definition of
EMMs</a></li>
<li><a href="#RG">More on the reference grid</a></li>
</ol>
</li>
<li>
<a href="#othertopics">Other topics</a>
<ol style="list-style-type: lower-alpha">
<li><a href="#arguments">Passing arguments</a></li>
<li><a href="#transf">Transformations</a></li>
<li><a href="#depcovs">Derived covariates</a></li>
<li><a href="#params">Non-predictor variables</a></li>
<li><a href="#plots">Graphical displays</a></li>
<li><a href="#formatting">Formatting results</a></li>
<li><a href="#weights">Using weights</a></li>
<li><a href="#multiv">Multivariate responses</a></li>
</ol>
</li>
<li><a href="#emmobj">Objects, structures, and methods</a></li>
<li><a href="#pvalues">P values, “significance”, and
recommendations</a></li>
<li><a href="#summary">Summary</a></li>
<li><a href="#more">Further reading</a></li>
</ol>
<p><a href="vignette-topics.html">Index of all vignette topics</a></p>
</div>
<div class="section level2">
<h2 id="found">Foundations<a class="anchor" aria-label="anchor" href="#found"></a>
</h2>
<!-- @index Foundations of EMMs; Expected marginal means!Foundations of -->
<div class="section level3">
<h3 id="exper">Emphasis on experimental data<a class="anchor" aria-label="anchor" href="#exper"></a>
</h3>
<!-- @index Experimental versus observational data;
            Observational versus experimental data;  
            Controlled experiments; Latin squares; Balanced allocation;
            Weighting!Equal weights; -->
<p>To start off with, we should emphasize that the underpinnings of
estimated marginal means – and much of what the <strong>emmeans</strong>
package offers – relate more to <em>experimental</em> data than to
<em>observational</em> data. In observational data, we sample from some
population, and the goal of statistical analysis is to characterize that
population in some way. In contrast, with experimental data, the
experimenter controls the environment under which test runs are
conducted, and in which responses are observed and recorded. Thus with
experimentation, the population is an abstract entity consisting of
potential outcomes of test runs made under conditions we enforce, rather
than a physical entity that we observe without changing it.</p>
<p>We say this because the default behavior of the
<code><a href="../reference/emmeans.html">emmeans()</a></code> function is to average groups together with equal
weights; this is common in analysis of experiments, but not common in
analysis of observational data; and I think that misunderstandings about
this underlie some criticisms such as <a href="https://stats.stackexchange.com/questions/332167/what-are-ls-means-useful-for" class="external-link">are
found here</a> and <a href="https://stats.stackexchange.com/questions/510862/is-least-squares-means-lsmeans-statistical-nonsense/510923#510923" class="external-link">here</a>.</p>
<p>Consider, for example, a classic Latin square experimental design. RA
Fisher and others expounded on such designs. Suppose we want to compare
four treatments, say fertilizers, in an agricultural experiment. A Latin
square plan would involve dividing a parcel of land into four rows and
four columns, defining 16 plots. Then we apply one of the fertilizers to
each plot in such a way that each fertilizer appears once in each row
and once in each column (and thus, each row and each column contains all
four fertilizers). This scheme, to some extent, controls for possible
spatial effects within the land parcel. To compare the fertilizer, we
average together the response values (say, yield of a crop) observed on
the four plots where each fertilizer was used. It seems right to average
these together with equal weight, because each experimental condition
seems equally valid and there is no reason to give one more weight than
another. In this illustration, the fertilizer means are not marginal
means of some physical population; they are simply the means obtained
under the four test conditions defined by the experiment.</p>
</div>
<div class="section level3">
<h3 id="models">Emphasis on models<a class="anchor" aria-label="anchor" href="#models"></a>
</h3>
<!-- @index Modelling; Expected marginal means!Reliance on a model;
            Model!Importance of; GIGO (garbage in, garbage out); -->
<p>The <strong>emmeans</strong> package requires you to fit a model to
your data. All the results obtained in <strong>emmeans</strong> rely on
this model. So, really, the analysis obtained is really an analysis of
the model, not the data. This analysis does depend on the data, but only
insofar as the fitted model depends on the data. We use predictions from
this model to compute estimated marginal means (EMMs), which will be
defined more explicitly below. For now, there are two things to
know:</p>
<ol style="list-style-type: decimal">
<li>If you change the model, that changes the EMMs</li>
<li>If the model fits poorly, the EMMs represent the data poorly (the
garbage in, garbage out principle)</li>
</ol>
<p>So to use this package to analyze your data, the most important first
step is to fit a good model.</p>
<p><a href="#contents">Back to Contents</a></p>
</div>
<div class="section level3">
<h3 id="pigs">Illustration: <code>pigs</code> experiment<a class="anchor" aria-label="anchor" href="#pigs"></a>
</h3>
<!-- @index Examples!`pigs`; Examples!Unbalanced data; 
            Modeling!Response transformation; Modeling!`pigs` example; 
            `inverse()`; Residual plots; R-squared; Adjusted R-squared -->
<p>Consider the <code>pigs</code> dataset provided with the package
(<code><a href="../reference/pigs.html">help("pigs")</a></code> provides details). These data come from an
experiment where pigs are given different percentages of protein
(<code>percent</code>) from different sources (<code>source</code>) in
their diet, and later we measured the concentration (<code>conc</code>)
of leucine. The <code>percent</code> values are quantitative, but we
chose those particular values deliberately, and (at least initially) we
want separate estimates at each <code>percent</code> level; that is, we
want to view <code>percent</code> as a factor, not a quantitative
predictor.</p>
<p>As discussed, our first task is to come up with a good model. Doing
so requires a lot of skill, and we don’t want to labor too much over the
details; you really need other references to deal with this aspect
adequately. But we will briefly discuss five models and settle on one of
them:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">conc</span> <span class="op">~</span> <span class="va">source</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">percent</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">pigs</span><span class="op">)</span></span>
<span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">mod1</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">source</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">percent</span><span class="op">)</span><span class="op">)</span>   <span class="co"># no interaction</span></span></code></pre></div>
<p>These models have <span class="math inline">\(R^2\)</span> values of
0.808 and 0.700, and adjusted <span class="math inline">\(R^2\)</span>
values of 0.684 and 0.634. <code>mod1</code> is preferable to
<code>mod2</code>, suggesting we need the interaction term. However, a
residual-vs-predicted plot of <code>mod2</code> has a classic “horn”
shape (curving and fanning out), indicating a situation where a response
transformation might help better than including the interaction.</p>
<p>It turns out that an inverse transformation, (<code>1/conc</code>)
really serves us well. (Perhaps this isn’t too surprising, as
concentrations are typically determined by titration, in which the
actual measurements are volumes; and these are reciprocally related to
concentrations, i.e., amounts <em>per</em> unit volume.)</p>
<p>So here are three more models:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">mod1</span>, <span class="fu"><a href="../reference/make.tran.html">inverse</a></span><span class="op">(</span><span class="va">conc</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span></span>
<span><span class="va">mod4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">mod2</span>, <span class="fu"><a href="../reference/make.tran.html">inverse</a></span><span class="op">(</span><span class="va">conc</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span>     <span class="co"># no interaction</span></span>
<span><span class="va">mod5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">mod4</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">source</span> <span class="op">+</span> <span class="va">percent</span><span class="op">)</span>  <span class="co"># linear term for percent</span></span></code></pre></div>
<p>(Note: We could have used <code>1/conc</code> as the response
variable, but <strong>emmeans</strong> provides an equivalent
<code><a href="../reference/make.tran.html">inverse()</a></code> function that will prove more advantageous
later.) The residual plots for these models look a lot more like a
random scatter of points (and that is good). The <span class="math inline">\(R^2\)</span> values for these models are 0.818,
0.787, and 0.749, respectively; and the adjusted <span class="math inline">\(R^2\)</span>s are 0.700, 0.740, and 0.719.
<code>mod4</code> has the best adjusted <span class="math inline">\(R^2\)</span> and will be our choice.</p>
<p><a href="#contents">Back to Contents</a></p>
</div>
<div class="section level3">
<h3 id="emms">Estimated marginal means<a class="anchor" aria-label="anchor" href="#emms"></a>
</h3>
<!-- @index Estimated marginal means!Demonstrated; 
            Estimated marginal means!Reference grid; Reference grid;
            Estimated marginal means!vs. ordinary marginal means;
            Simpson's paradox; Confounding;  `emmeans()`; -->
<p>Now that we have a good model, let’s use the <code><a href="../reference/emmeans.html">emmeans()</a></code>
function to obtain estimated marginal means (EMMs). We’ll explain them
later.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">EMM.source</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">mod4</span>, <span class="st">"source"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  source emmean       SE df lower.CL upper.CL</span></span>
<span><span class="co">##  fish   0.0337 0.000926 23   0.0318   0.0356</span></span>
<span><span class="co">##  soy    0.0257 0.000945 23   0.0237   0.0276</span></span>
<span><span class="co">##  skim   0.0229 0.000994 23   0.0208   0.0249</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: percent </span></span>
<span><span class="co">## Results are given on the inverse (not the response) scale. </span></span>
<span><span class="co">## Confidence level used: 0.95</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">EMM.percent</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">mod4</span>, <span class="st">"percent"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  percent emmean       SE df lower.CL upper.CL</span></span>
<span><span class="co">##        9 0.0322 0.001032 23   0.0301   0.0344</span></span>
<span><span class="co">##       12 0.0270 0.000969 23   0.0250   0.0290</span></span>
<span><span class="co">##       15 0.0263 0.001104 23   0.0240   0.0286</span></span>
<span><span class="co">##       18 0.0241 0.001337 23   0.0213   0.0268</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: source </span></span>
<span><span class="co">## Results are given on the inverse (not the response) scale. </span></span>
<span><span class="co">## Confidence level used: 0.95</span></span></code></pre>
<p>Let’s compare these with the ordinary marginal means (OMMs) on
<code>inverse(conc)</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pigs</span>, <span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="fu"><a href="../reference/make.tran.html">inverse</a></span><span class="op">(</span><span class="va">conc</span><span class="op">)</span>, <span class="va">source</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##       fish        soy       skim </span></span>
<span><span class="co">## 0.03331687 0.02632333 0.02372024</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pigs</span>, <span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="fu"><a href="../reference/make.tran.html">inverse</a></span><span class="op">(</span><span class="va">conc</span><span class="op">)</span>, <span class="va">percent</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##          9         12         15         18 </span></span>
<span><span class="co">## 0.03146170 0.02700341 0.02602757 0.02659336</span></span></code></pre>
<p>Both sets of OMMs are vaguely similar to the corresponding EMMs.
However, please note that the EMMs for <code>percent</code> form a
decreasing sequence, while the the OMMs decrease but then increase at
the end.</p>
</div>
<div class="section level3">
<h3 id="refgrid">The reference grid, and definition of EMMs<a class="anchor" aria-label="anchor" href="#refgrid"></a>
</h3>
<!-- @index Estimated marginal means!Definition of; 
            Reference grid!Predictions on;
            Estimated marginal means!Manually computed; -->
<p>Estimated marginal means are defined as marginal means of model
predictions over the grid comprising all factor combinations – called
the <em>reference grid</em>. For the example at hand, the reference grid
is</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">RG</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>source <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">pigs</span><span class="op">$</span><span class="va">source</span><span class="op">)</span>, percent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">pigs</span><span class="op">$</span><span class="va">percent</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##    source percent</span></span>
<span><span class="co">## 1    fish       9</span></span>
<span><span class="co">## 2     soy       9</span></span>
<span><span class="co">## 3    skim       9</span></span>
<span><span class="co">## 4    fish      12</span></span>
<span><span class="co">## 5     soy      12</span></span>
<span><span class="co">## 6    skim      12</span></span>
<span><span class="co">## 7    fish      15</span></span>
<span><span class="co">## 8     soy      15</span></span>
<span><span class="co">## 9    skim      15</span></span>
<span><span class="co">## 10   fish      18</span></span>
<span><span class="co">## 11    soy      18</span></span>
<span><span class="co">## 12   skim      18</span></span></code></pre>
<p>To get the EMMs, we first need to obtain predictions on this
grid:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mod4</span>, newdata <span class="op">=</span> <span class="va">RG</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##            [,1]       [,2]       [,3]       [,4]</span></span>
<span><span class="co">## [1,] 0.03853514 0.03329091 0.03256404 0.03036586</span></span>
<span><span class="co">## [2,] 0.03050486 0.02526063 0.02453376 0.02233558</span></span>
<span><span class="co">## [3,] 0.02770292 0.02245869 0.02173182 0.01953364</span></span></code></pre>
<p>then obtain the marginal means of these predictions:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">preds</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span>   <span class="co"># row means -- for source</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## [1] 0.03368899 0.02565870 0.02285677</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">preds</span>, <span class="fl">2</span>, <span class="va">mean</span><span class="op">)</span>   <span class="co"># column means -- for percent</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## [1] 0.03224764 0.02700341 0.02627654 0.02407836</span></span></code></pre>
<p>These marginal averages match the EMMs obtained earlier via
<code><a href="../reference/emmeans.html">emmeans()</a></code>.</p>
<p>Now let’s go back to the comparison with the ordinary marginal means.
The <code>source</code> levels are represented by the columns of
<code>pred</code>; and note that each row of <code>pred</code> is a
decreasing set of values. So it is no wonder that the marginal means –
the EMMs for <code>source</code> – are decreasing. That the OMMs for
<code>percent</code> do not behave this way is due to the imbalance in
sample sizes:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pigs</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">source</span>, <span class="va">percent</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##       percent</span></span>
<span><span class="co">## source 9 12 15 18</span></span>
<span><span class="co">##   fish 2  3  2  3</span></span>
<span><span class="co">##   soy  3  3  3  1</span></span>
<span><span class="co">##   skim 3  3  2  1</span></span></code></pre>
<p>This shows that the OMMs of the last column give most of the weight
(3/5) to the first source, which tends to have higher
<code>inverse(conc)</code>, making the OMM for 18 percent higher than
that for 15 percent, even though the reverse is true with every level of
<code>source</code>. This kind of disconnect is an example of
<em>Simpson’s paradox,</em> in which a confounding factor can distort
your findings. The EMMs are not subject to this paradox, but the OMMs
are, when the sample sizes are correlated with the expected values.</p>
<p>In summary, we obtain a references grid of all factor combinations,
obtain model predictions on that grid, and then the expected marginal
means are estimated as equally-weighted marginal averages of those
predictions. Those EMMs are not subject to confounding by other factors,
such as might happen with ordinary marginal means of the data. Moreover,
unlike OMMs, EMMs are based on a model that is fitted to the data.</p>
<p><a href="#contents">Back to Contents</a></p>
</div>
<div class="section level3">
<h3 id="RG">More on the reference grid<a class="anchor" aria-label="anchor" href="#RG"></a>
</h3>
<!-- @index Reference grid!Defined; `ref_grid()`; 
            `ref_grid()`!`at`; `ref_grid()`!`cov.reduce`;
            Reference grid!Covariates; Adjusted means; 
            Reference grid!Indicator variables; Indicator variables;  -->
<p>In the previous section, we discussed the reference grid as being the
set of all factor combinations. It is slightly more complicated than
that when we have numerical predictors (AKA covariates) in the model. By
default, we use the average of each covariate – thus not enlarging the
number of combinations comprising the grid. Using the covariate
average(s) yields what are often called <em>adjusted means</em>. There
is one exception, though: if a covariate has only two different values,
we treat it as a factor having those two levels. For example, a model
could include an indicator variable <code>male</code> that is
<code>1</code> if the subject is male, and <code>0</code> otherwise.
Then <code>male</code> would be viewed as a factor with levels
<code>0</code> and <code>1</code>. Note, again, that the reference grid
is formulated from the model we are using.</p>
<p>We can see a snapshot of the reference grid via the
<code>ref_grid</code> function; for example</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">RG4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ref_grid.html">ref_grid</a></span><span class="op">(</span><span class="va">mod4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## 'emmGrid' object with variables:</span></span>
<span><span class="co">##     source = fish, soy, skim</span></span>
<span><span class="co">##     percent =  9, 12, 15, 18</span></span>
<span><span class="co">## Transformation: "inverse"</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ref_grid.html">ref_grid</a></span><span class="op">(</span><span class="va">mod5</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## 'emmGrid' object with variables:</span></span>
<span><span class="co">##     source = fish, soy, skim</span></span>
<span><span class="co">##     percent = 12.931</span></span>
<span><span class="co">## Transformation: "inverse"</span></span></code></pre>
<p>The reference grid for <code>mod5</code> is different from that for
<code>mod4</code> because in those models, <code>percent</code> is a
factor in <code>mod4</code> and a covariate in <code>mod5</code>.</p>
<p>It is possible to modify the reference grid. In the context of the
present example, it might be inetersting to compare EMMs based on
<code>mod4</code> and <code>mod5</code>, and we can put them on an equal
footing by using the same <code>percent</code> values as reference
levels:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">RG5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ref_grid.html">ref_grid</a></span><span class="op">(</span><span class="va">mod5</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>percent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">9</span>, <span class="fl">12</span>, <span class="fl">15</span>, <span class="fl">18</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## 'emmGrid' object with variables:</span></span>
<span><span class="co">##     source = fish, soy, skim</span></span>
<span><span class="co">##     percent =  9, 12, 15, 18</span></span>
<span><span class="co">## Transformation: "inverse"</span></span></code></pre>
<p>We could also have done this using</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>(RG5 <span class="ot">&lt;-</span> <span class="fu">ref_grid</span>(mod5, <span class="at">cov.reduce =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>… which tells <code><a href="../reference/ref_grid.html">ref_grid()</a></code> to set covariate levels using
unique values. It’s safer to use <code>at</code> because
<code>cov.reduce</code> affects <em>all</em> covariates instead of
specific ones. ###### {#emmip}
<!-- @index `emmip()`; Interaction-style plots; --> The two models’
predictions can be compared using interaction-style plots via the
<code><a href="../reference/emmip.html">emmip()</a></code> function</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emmip.html">emmip</a></span><span class="op">(</span><span class="va">RG4</span>, <span class="va">source</span> <span class="op">~</span> <span class="va">percent</span>, style <span class="op">=</span> <span class="st">"factor"</span><span class="op">)</span></span></code></pre></div>
<p><img src="basics_files/figure-html/unnamed-chunk-13-1.png" alt="interaction-style plots of 'RG4' and 'RG5'. These show parallel trends along 'percent' for each 'source'. The one for 'RG5' consists of parallel straigt lines. The values plotted here can be obtained via 'summary(RG4)' and 'summary(RG5)'" width="432"></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emmip.html">emmip</a></span><span class="op">(</span><span class="va">RG5</span>, <span class="va">source</span> <span class="op">~</span> <span class="va">percent</span>, style <span class="op">=</span> <span class="st">"factor"</span><span class="op">)</span></span></code></pre></div>
<p><img src="basics_files/figure-html/unnamed-chunk-13-2.png" alt="interaction-style plots of 'RG4' and 'RG5'. These show parallel trends along 'percent' for each 'source'. The one for 'RG5' consists of parallel straigt lines. The values plotted here can be obtained via 'summary(RG4)' and 'summary(RG5)'" width="432">
Both plots show three parallel trends, because neither model includes an
interaction term; but of course for <code>mod5</code>, those trends are
straight lines.</p>
<p><a href="#contents">Back to Contents</a></p>
</div>
</div>
<div class="section level2">
<h2 id="othertopics">Other topics<a class="anchor" aria-label="anchor" href="#othertopics"></a>
</h2>
<div class="section level3">
<h3 id="arguments">Passing arguments<a class="anchor" aria-label="anchor" href="#arguments"></a>
</h3>
<!-- @index Arguments!Passed to `ref_grid()`; Arguments!`...`
     `emmeans()`!Arguments passed to `ref_grid()`; -->
<p>Quite a few functions in the <strong>emmeans</strong> package,
including <code><a href="../reference/emmeans.html">emmeans()</a></code> and <code><a href="../reference/emmip.html">emmip()</a></code>, can take
either a model object or a reference-grid object as their first
argument. Thus we can obtain EMMs for <code>mod5</code> directly from
<code>RG5</code>, e.g.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">RG5</span>, <span class="st">"source"</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  source emmean       SE df lower.CL upper.CL</span></span>
<span><span class="co">##  fish   0.0336 0.000958 25   0.0316   0.0355</span></span>
<span><span class="co">##  soy    0.0255 0.000971 25   0.0235   0.0275</span></span>
<span><span class="co">##  skim   0.0227 0.001030 25   0.0206   0.0248</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: percent </span></span>
<span><span class="co">## Results are given on the inverse (not the response) scale. </span></span>
<span><span class="co">## Confidence level used: 0.95</span></span></code></pre>
<p>These are slightly different results than we had earlier for
<code>mod4</code>. In these functions where the model and the reference
grid are interchangeable, the first thing the function does is to check
which it is; and if it is a model object, it constructs the reference
grid. When it does that, it passes its arguments to
<code><a href="../reference/ref_grid.html">ref_grid()</a></code> in case they are needed. For instance, the above
EMMs could have been obtained using</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">mod5</span>, <span class="st">"source"</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>percent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">9</span>, <span class="fl">12</span>, <span class="fl">15</span>, <span class="fl">18</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## (same results as above)</span></span></code></pre></div>
<p>It is a great convenience to be able to pass arguments to
<code><a href="../reference/ref_grid.html">ref_grid()</a></code>, but it also can confuse new users, because if
we look at the help page for <code><a href="../reference/emmeans.html">emmeans()</a></code>, it does not list
<code>at</code> as a possible argument. It is mentioned, though, if you
look at the <code>...</code> argument. So develop a habit of looking at
documentation for other functions, especially <code><a href="../reference/ref_grid.html">ref_grid()</a></code>,
for other arguments that may affect your results.</p>
<p><a href="#contents">Back to Contents</a></p>
</div>
<div class="section level3">
<h3 id="transf">Transformations<a class="anchor" aria-label="anchor" href="#transf"></a>
</h3>
<!-- @index Transformations; Response transformations; Back-transforming;
            `type = "response"`; -->
<p>In our running example with <code>pigs</code>, by now you are surely
tired of seeing all the answers on the <code>inverse(conc)</code> scale.
What about estimating things on the <code>conc</code> scale? You may
have noticed that the <code>inverse</code> transformation has not been
forgotten; it is mentioned in the annotations below the
<code><a href="../reference/emmeans.html">emmeans()</a></code> output. [I’d also comment that having used
<code>inverse(conc)</code> rather than <code>1/conc</code> as the
response variable in the model has made it easier to sort things out,
because <code><a href="../reference/make.tran.html">inverse()</a></code> is a named transformation that
<code><a href="../reference/emmeans.html">emmeans()</a></code> can work with.] We can back-transform the results
by specifying <code>type = "response"</code> in any function call where
it makes sense. For instance,</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">RG4</span>, <span class="st">"source"</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  source response    SE df lower.CL upper.CL</span></span>
<span><span class="co">##  fish       29.7 0.816 23     28.1     31.5</span></span>
<span><span class="co">##  soy        39.0 1.436 23     36.2     42.2</span></span>
<span><span class="co">##  skim       43.8 1.903 23     40.1     48.1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: percent </span></span>
<span><span class="co">## Confidence level used: 0.95 </span></span>
<span><span class="co">## Intervals are back-transformed from the inverse scale</span></span></code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emmip.html">emmip</a></span><span class="op">(</span><span class="va">RG4</span>, <span class="va">source</span> <span class="op">~</span> <span class="va">percent</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span></code></pre></div>
<p><img src="basics_files/figure-html/unnamed-chunk-16-1.png" alt="interaction-style plots for 'RG4' after back-transforming. Compared to the plots of 'RG4' without back-transforming, these trends increase rather than decrease (due to the inverse transformation) and they fan-out somewhat as 'percent' increases. The values plotted here are obtainable via 'summary(RG4, type = &quot;response&quot;)'" width="432">
We are now on the <code>conc</code> scale, and that will likely be less
confusing. Compared with the earlier plots in which the trends were
decreasing and parallel, this plot has them increasing (because of the
inverse relationship) and non-parallel. An interaction that occurs on
the response scale is pretty well explained by a model with no
interactions on the inverse scale.</p>
<p>Transformations have a lot of nuances, and we refer you to the <a href="transformations.html">vignette of transformations</a> for more
details.</p>
<p><a href="#contents">Back to Contents</a></p>
</div>
<div class="section level3">
<h3 id="depcovs">Derived covariates<a class="anchor" aria-label="anchor" href="#depcovs"></a>
</h3>
<!-- @index Covariates!Derived; Quadratic terms; Polynomial regression;
            Examples!`mtcars`;        -->
<p>You need to be careful when one covariate depends on the value of
another. To illustrate using the <code><a href="https://rdrr.io/r/datasets/mtcars.html" class="external-link">datasets::mtcars</a></code> data,
suppose we want to predict <code>mpg</code> using <code>cyl</code>
(number of cylinders) as a factor <code>disp</code> (displacement) as a
covariate, and include a quadratic term for <code>disp</code>. Here are
two equivalent models:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mcmod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span> <span class="op">+</span> <span class="va">disp</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">disp</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="va">mtcars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">mtcars</span>, </span>
<span>                    dispsq <span class="op">=</span> <span class="va">disp</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">mcmod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span> <span class="op">+</span> <span class="va">disp</span> <span class="op">+</span> <span class="va">dispsq</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span></code></pre></div>
<p>These two models have exactly the same predicted values. But look at
the EMMs:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">mcmod1</span>, <span class="st">"cyl"</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  cyl emmean   SE df lower.CL upper.CL</span></span>
<span><span class="co">##    4   19.3 2.66 27     13.9     24.8</span></span>
<span><span class="co">##    6   17.2 1.36 27     14.4     20.0</span></span>
<span><span class="co">##    8   18.8 1.47 27     15.7     21.8</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Confidence level used: 0.95</span></span></code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">mcmod2</span>, <span class="st">"cyl"</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  cyl emmean   SE df lower.CL upper.CL</span></span>
<span><span class="co">##    4   20.8 2.05 27     16.6     25.0</span></span>
<span><span class="co">##    6   18.7 1.19 27     16.3     21.1</span></span>
<span><span class="co">##    8   20.2 1.77 27     16.6     23.9</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Confidence level used: 0.95</span></span></code></pre>
<p>Wow! Those are really different results – even though the models are
equivalent. Why is this – and which (if either) is right? To understand,
look at the reference grids:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ref_grid.html">ref_grid</a></span><span class="op">(</span><span class="va">mcmod1</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## 'emmGrid' object with variables:</span></span>
<span><span class="co">##     cyl = 4, 6, 8</span></span>
<span><span class="co">##     disp = 230.72</span></span></code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ref_grid.html">ref_grid</a></span><span class="op">(</span><span class="va">mcmod2</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## 'emmGrid' object with variables:</span></span>
<span><span class="co">##     cyl = 4, 6, 8</span></span>
<span><span class="co">##     disp = 230.72</span></span>
<span><span class="co">##     dispsq = 68113</span></span></code></pre>
<p>For both models, the reference grid uses the <code>disp</code> mean
of 230.72. But for <code>mcmod2</code>, <code>dispsq</code> is a
separate covariate, and it is set to its mean of 68113. This is not
right, because it is impossible to have <code>disp</code> equal to
230.72 and its square equal to 68113 at the same time! If we use
consistent values of <code>disp</code> and<code>dispsq</code>, we get
the same results as for <code>mcmod1</code>:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">mcmod2</span>, <span class="st">"cyl"</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>disp <span class="op">=</span> <span class="fl">230.72</span>, dispsq <span class="op">=</span> <span class="fl">230.72</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  cyl emmean   SE df lower.CL upper.CL</span></span>
<span><span class="co">##    4   19.3 2.66 27     13.9     24.8</span></span>
<span><span class="co">##    6   17.2 1.36 27     14.4     20.0</span></span>
<span><span class="co">##    8   18.8 1.47 27     15.7     21.8</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Confidence level used: 0.95</span></span></code></pre>
<p>In summary, for polynomial models and others where some covariates
depend on others in nonlinear ways, it is definitely best to include
that dependence in the model formula (as in <code>mcmod1</code>) using
<code><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I()</a></code> or <code><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly()</a></code> expressions, or alter the
reference grid so that the dependency among covariates is correct.</p>
<p><a href="#contents">Back to Contents</a></p>
</div>
<div class="section level3">
<h3 id="params">Non-predictor variables<a class="anchor" aria-label="anchor" href="#params"></a>
</h3>
<!-- @index `params`; Variables that are not predictors; -->
<p>Reference grids are derived using the variables in the right-hand
side of the model formula. But sometimes, these variables are not
actually predictors. For example:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">deg</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">treat</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">x</span>, degree <span class="op">=</span> <span class="va">deg</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mydata</span><span class="op">)</span></span></code></pre></div>
<p>If we call <code><a href="../reference/ref_grid.html">ref_grid()</a></code> or <code><a href="../reference/emmeans.html">emmeans()</a></code> with
this model, it will try to construct a grid of values of
<code>treat</code>, <code>x</code>, and <code>deg</code> – causing an
error because <code>deg</code> is not a predictor in this model. To get
things to work correctly, you need to name <code>deg</code> in a
<code>params</code> argument, e.g.,</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">mod</span>, <span class="op">~</span> <span class="va">treat</span> <span class="op">|</span> <span class="va">x</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, params <span class="op">=</span> <span class="st">"deg"</span><span class="op">)</span></span></code></pre></div>
<p><a href="#contents">Back to Contents</a></p>
</div>
<div class="section level3">
<h3 id="plots">Graphical displays<a class="anchor" aria-label="anchor" href="#plots"></a>
</h3>
<!-- @index Graphical displays; Plots!of EMMs@emms; Plots!Interaction-style; 
            `emmip()`; `plot()`;  -->
<p>The results of <code><a href="../reference/ref_grid.html">ref_grid()</a></code> or <code><a href="../reference/emmeans.html">emmeans()</a></code>
(these are objects of class <code>emmGrid</code>) may be plotted in two
different ways. One we have already seen is an interaction-style plot,
using <code><a href="../reference/emmip.html">emmip()</a></code>.</p>
<p>The formula specification we used in
<code>emmip(RG4, source ~ percent)</code> sets the <em>x</em> variable
to be the one on the right-hand side and the “trace” factor (what is
used to define the different curves) on the left.</p>
<div class="section level6">
<h6 id="plot-emmGrid"></h6>
<!-- @index Plots!of confidence intervals@conf; `plot.emmGrid()`;
            `ref_grid()`!`cov.reduce`; -->
<p>The other graphics option offered is the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method
for <code>emmGrid</code> objects. Let’s consider a different model for
the <code>mtcars</code> data with both <code>cyl</code> and
<code>disp</code> as covariates</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mcmod3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">disp</span> <span class="op">*</span> <span class="va">cyl</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span></code></pre></div>
<p>In the following, we display the estimates and 95% confidence
intervals for <code>RG4</code> in separate panels for each
<code>source</code>.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EMM3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">mcmod3</span>, <span class="op">~</span> <span class="va">cyl</span> <span class="op">|</span> <span class="va">disp</span>, </span>
<span>                at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cyl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">8</span><span class="op">)</span>, disp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">200</span>,<span class="fl">300</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">EMM3</span><span class="op">)</span></span></code></pre></div>
<p><img src="basics_files/figure-html/unnamed-chunk-24-1.png" alt="Plot of side-by-side confidence intervals for 'cyl' means, in 3 panels corresponding to 'disp' values of 100, 200, and 300. The values plotted here are those in 'summary(EMM3)'" width="432"></p>
<p>This plot illustrates, as much as anything else, how silly it is to
try to predict mileage for a 4-cylinder car having high displacement, or
an 8-cylinder car having low displacement. The widths of the intervals
give us a clue that we are extrapolating. A better idea is to
acknowledge that displacement largely depends on the number of
cylinders. So here is yet another way to use <code>cov.reduce</code> to
modify the reference grid:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mcrg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ref_grid.html">ref_grid</a></span><span class="op">(</span><span class="va">mcmod3</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cyl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                         cov.reduce <span class="op">=</span> <span class="va">disp</span> <span class="op">~</span> <span class="va">cyl</span><span class="op">)</span></span>
<span><span class="va">mcrg</span> <span class="op">@</span> <span class="va">grid</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##        disp cyl .wgt.</span></span>
<span><span class="co">## 1  93.78673   4     1</span></span>
<span><span class="co">## 2 218.98458   6     1</span></span>
<span><span class="co">## 3 344.18243   8     1</span></span></code></pre>
<p>The <code>ref_grid</code> call specifies that <code>disp</code>
depends on <code>cyl</code>; so a linear model is fitted with the given
formula and its fitted values are used as the <code>disp</code> values –
only one for each <code>cyl</code>. If we plot this grid, the results
are sensible, reflecting what the model predicts for typical cars with
each number of cylinders:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mcrg</span><span class="op">)</span></span></code></pre></div>
<p><img src="basics_files/figure-html/unnamed-chunk-26-1.png" alt="Side-by-side CIs for cyl marginal means. The values plotted are obtainable via 'summary(mcrg)'" width="432"></p>
</div>
<div class="section level6">
<h6 id="ggplot"></h6>
<!-- @index **ggplot2** package; Plots!Enhancing with **ggplot2** functions -->
<p>Wizards with the <strong>ggplot2</strong> package can further enhance
these plots if they like. For example, we can add the data to an
interaction plot – this time we opt to include confidence intervals and
put the three sources in separate panels:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/emmip.html">emmip</a></span><span class="op">(</span><span class="va">mod4</span>, <span class="op">~</span> <span class="va">percent</span> <span class="op">|</span> <span class="va">source</span>, CIs <span class="op">=</span> <span class="cn">TRUE</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">percent</span>, y <span class="op">=</span> <span class="va">conc</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">pigs</span>, pch <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></code></pre></div>
<p><img src="basics_files/figure-html/unnamed-chunk-27-1.png" alt="Enhanced interaction plot with CIs and observed data added; we have separate panels for the 3 diets, and the 4 percent conentrations in each panel" width="432"></p>
<p><a href="#contents">Back to Contents</a></p>
</div>
</div>
<div class="section level3">
<h3 id="formatting">Formatting results<a class="anchor" aria-label="anchor" href="#formatting"></a>
</h3>
<!-- @index Formatting results; `kable`; Exporting output; `xtable` method; 
  RMarkdown; -->
<p>If you want to include <code><a href="../reference/emmeans.html">emmeans()</a></code> results in a report,
you might want to have it in a nicer format than just the printed
output. We provide a little bit of help for this, especially if you are
using RMarkdown or SWeave to prepare the report. There is an
<code>xtable</code> method for exporting these results, which we do not
illustrate here but it works similarly to <code>xtable()</code> in other
contexts. Also, the <code>export</code> option the <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code>
method allows the user to save exactly what is seen in the printed
output as text, to be saved or formatted as the user likes (see the
documentation for <code>print.emmGrid</code> for details). Here is an
example using one of the objects above:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">mcrg</span>, level <span class="op">=</span> <span class="fl">0.90</span>, adjust <span class="op">=</span> <span class="st">"scheffe"</span><span class="op">)</span></span>
<span><span class="va">xport</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ci</span>, export <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"&lt;font color = 'blue'&gt;\n"</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">xport</span><span class="op">$</span><span class="va">summary</span>, align <span class="op">=</span> <span class="st">"r"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">a</span> <span class="kw">in</span> <span class="va">xport</span><span class="op">$</span><span class="va">annotations</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">a</span>, <span class="st">"&lt;br&gt;"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"&lt;/font&gt;\n"</span><span class="op">)</span></span></code></pre></div>
<p><font color="blue"></font></p>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">disp</th>
<th align="right">cyl</th>
<th align="right">prediction</th>
<th align="right">SE</th>
<th align="right">df</th>
<th align="right">lower.CL</th>
<th align="right">upper.CL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"></td>
<td align="right">93.8</td>
<td align="right">4</td>
<td align="right">27.7</td>
<td align="right">0.858</td>
<td align="right">28</td>
<td align="right">25.5</td>
<td align="right">30.0</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="right">219.0</td>
<td align="right">6</td>
<td align="right">17.6</td>
<td align="right">1.066</td>
<td align="right">28</td>
<td align="right">14.8</td>
<td align="right">20.4</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="right">344.2</td>
<td align="right">8</td>
<td align="right">15.4</td>
<td align="right">0.692</td>
<td align="right">28</td>
<td align="right">13.5</td>
<td align="right">17.2</td>
</tr>
</tbody>
</table>
<p>Confidence level used: 0.9 <br>Conf-level adjustment: scheffe method
with rank 3 <br></p>
<p><a href="#contents">Back to Contents</a></p>
</div>
<div class="section level3">
<h3 id="weights">Using weights<a class="anchor" aria-label="anchor" href="#weights"></a>
</h3>
<!-- @index Means!Weighted; `emmeans()`!`weights`; Observational data; -->
<p>As we have mentioned, <code><a href="../reference/emmeans.html">emmeans()</a></code> uses equal weighting by
default, based on its foundations in experimental situations. When you
have observational data, you are more likely to use unequal weights that
more accurately characterize the population. Accordingly, a
<code>weights</code> argument is provided in <code><a href="../reference/emmeans.html">emmeans()</a></code>. For
example, using <code>weights = "cells"</code> in the call will weight
the predictions according to their cell frequencies (recall this
information is retained in the reference grid). This produces results
comparable to ordinary marginal means:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">mod4</span>, <span class="st">"percent"</span>, weights <span class="op">=</span> <span class="st">"cells"</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  percent emmean       SE df lower.CL upper.CL</span></span>
<span><span class="co">##        9 0.0315 0.001028 23   0.0293   0.0336</span></span>
<span><span class="co">##       12 0.0270 0.000969 23   0.0250   0.0290</span></span>
<span><span class="co">##       15 0.0260 0.001099 23   0.0238   0.0283</span></span>
<span><span class="co">##       18 0.0266 0.001300 23   0.0239   0.0293</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: source </span></span>
<span><span class="co">## Results are given on the inverse (not the response) scale. </span></span>
<span><span class="co">## Confidence level used: 0.95</span></span></code></pre>
<p>Note that, as in the ordinary marginal means we obtained long ago,
the highest estimate is for <code>percent = 15</code> rather than
<code>percent = 18</code>. It is interesting to compare this with the
results for a model that includes only <code>percent</code> as a
predictor.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="../reference/make.tran.html">inverse</a></span><span class="op">(</span><span class="va">conc</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">percent</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">pigs</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">mod6</span>, <span class="st">"percent"</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  percent emmean      SE df lower.CL upper.CL</span></span>
<span><span class="co">##        9 0.0315 0.00196 25   0.0274   0.0355</span></span>
<span><span class="co">##       12 0.0270 0.00185 25   0.0232   0.0308</span></span>
<span><span class="co">##       15 0.0260 0.00210 25   0.0217   0.0303</span></span>
<span><span class="co">##       18 0.0266 0.00248 25   0.0215   0.0317</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are given on the inverse (not the response) scale. </span></span>
<span><span class="co">## Confidence level used: 0.95</span></span></code></pre>
<p>The EMMs in these two tables are identical, so in some sense,
<code>weights = "cells"</code> amounts to throwing-out the uninvolved
factors. However, note that these outputs show markedly different
standard errors. That is because the model <code>mod4</code> accounts
for variations due to <code>source</code> while <code>mod6</code> does
not. The lesson here is that it is possible to obtain statistics
comparable to ordinary marginal means, while still accounting for
variations due to the factors that are being averaged over.</p>
<p><a href="#contents">Back to Contents</a></p>
</div>
<div class="section level3">
<h3 id="multiv">Multivariate responses<a class="anchor" aria-label="anchor" href="#multiv"></a>
</h3>
<!-- @index Multivariate models; Examples!`MOats`
     Examples!Multivariate; `ref_grid()`!`mult.name` -->
<p>The <strong>emmeans</strong> package supports various multivariate
models. When there is a multivariate response, the dimensions of that
response are treated as if they were levels of a factor. For example,
the <code>MOats</code> dataset provided in the package has predictors
<code>Block</code> and <code>Variety</code>, and a four-dimensional
response <code>yield</code> giving yields observed with varying amounts
of nitrogen added to the soil. Here is a model and reference grid:</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MOats.lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span> <span class="op">(</span><span class="va">yield</span> <span class="op">~</span> <span class="va">Block</span> <span class="op">+</span> <span class="va">Variety</span>, data <span class="op">=</span> <span class="va">MOats</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ref_grid.html">ref_grid</a></span> <span class="op">(</span><span class="va">MOats.lm</span>, mult.name <span class="op">=</span> <span class="st">"nitro"</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## 'emmGrid' object with variables:</span></span>
<span><span class="co">##     Block = VI, V, III, IV, II, I</span></span>
<span><span class="co">##     Variety = Golden Rain, Marvellous, Victory</span></span>
<span><span class="co">##     nitro = multivariate response levels: 0, 0.2, 0.4, 0.6</span></span></code></pre>
<p>So, <code>nitro</code> is regarded as a factor having 4 levels
corresponding to the 4 dimensions of <code>yield</code>. We can
subsequently obtain EMMs for any of the factors <code>Block</code>,
<code>Variety</code>, <code>nitro</code>, or combinations thereof. The
argument <code>mult.name = "nitro"</code> is optional; if it had been
excluded, the multivariate levels would have been named
<code>rep.meas</code>.</p>
<p><a href="#contents">Back to Contents</a></p>
</div>
</div>
<div class="section level2">
<h2 id="emmobj">Objects, structures, and methods<a class="anchor" aria-label="anchor" href="#emmobj"></a>
</h2>
<!-- @index `emmGrid` objects -->
<p>The <code><a href="../reference/ref_grid.html">ref_grid()</a></code> and <code><a href="../reference/emmeans.html">emmeans()</a></code> functions are
introduced previously. These functions, and a few related ones, return
an object of class <code>emmGrid</code>. From previously defined
objects:</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">RG4</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## [1] "emmGrid"</span></span>
<span><span class="co">## attr(,"package")</span></span>
<span><span class="co">## [1] "emmeans"</span></span></code></pre>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">EMM.source</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## [1] "emmGrid"</span></span>
<span><span class="co">## attr(,"package")</span></span>
<span><span class="co">## [1] "emmeans"</span></span></code></pre>
<p>If you simply show these objects, you get different-looking
results:</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RG4</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## 'emmGrid' object with variables:</span></span>
<span><span class="co">##     source = fish, soy, skim</span></span>
<span><span class="co">##     percent =  9, 12, 15, 18</span></span>
<span><span class="co">## Transformation: "inverse"</span></span></code></pre>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EMM.source</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  source emmean       SE df lower.CL upper.CL</span></span>
<span><span class="co">##  fish   0.0337 0.000926 23   0.0318   0.0356</span></span>
<span><span class="co">##  soy    0.0257 0.000945 23   0.0237   0.0276</span></span>
<span><span class="co">##  skim   0.0229 0.000994 23   0.0208   0.0249</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: percent </span></span>
<span><span class="co">## Results are given on the inverse (not the response) scale. </span></span>
<span><span class="co">## Confidence level used: 0.95</span></span></code></pre>
<p>This is based on guessing what users most need to see when displaying
the object. You can override these defaults; for example to just see a
quick summary of what is there, do</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">EMM.source</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## 'emmGrid' object with variables:</span></span>
<span><span class="co">##     source = fish, soy, skim</span></span>
<span><span class="co">## Transformation: "inverse"</span></span></code></pre>
<!-- @index `str()`; `summary()`; `summary_emm` object; `print.summary_emm()` -->
<p>The most important method for <code>emmGrid</code> objects is
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>. It is used as the print method for displaying an
<code><a href="../reference/emmeans.html">emmeans()</a></code> result. For this reason, arguments for
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> may also be specified within most functions that
produce <code>these kinds of results.</code>emmGrid` objects. For
example:</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># equivalent to summary(emmeans(mod4, "percent"), level = 0.90, infer = TRUE))</span></span>
<span><span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">mod4</span>, <span class="st">"percent"</span>, level <span class="op">=</span> <span class="fl">0.90</span>, infer <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  percent emmean       SE df lower.CL upper.CL t.ratio p.value</span></span>
<span><span class="co">##        9 0.0322 0.001032 23   0.0305   0.0340  31.240  &lt;.0001</span></span>
<span><span class="co">##       12 0.0270 0.000969 23   0.0253   0.0287  27.872  &lt;.0001</span></span>
<span><span class="co">##       15 0.0263 0.001104 23   0.0244   0.0282  23.802  &lt;.0001</span></span>
<span><span class="co">##       18 0.0241 0.001337 23   0.0218   0.0264  18.009  &lt;.0001</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: source </span></span>
<span><span class="co">## Results are given on the inverse (not the response) scale. </span></span>
<span><span class="co">## Confidence level used: 0.9</span></span></code></pre>
<p>This <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> method for <code>emmGrid</code> objects)
actually produces a <code>data.frame</code>, but with extra bells and
whistles:</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">EMM.source</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## [1] "summary_emm" "data.frame"</span></span></code></pre>
<p>This can be useful to know because if you want to actually
<em>use</em> <code><a href="../reference/emmeans.html">emmeans()</a></code> results in other computations, you
should save its summary, and then you can access those results just like
you would access data in a data frame. The <code>emmGrid</code> object
itself is not so accessible. There is a <code>print.summary_emm()</code>
function that is what actually produces the output you see above – a
data frame with extra annotations.</p>
<p><a href="#contents">Back to Contents</a></p>
</div>
<div class="section level2">
<h2 id="pvalues">P values, “significance”, and recommendations<a class="anchor" aria-label="anchor" href="#pvalues"></a>
</h2>
<!-- @index Significance!Assessing; 
    *P* values!Interpreting; ATOM; 
    ASA Statement on *P* values -->
<p>There is some debate among statisticians and researchers about the
appropriateness of <em>P</em> values, and that the term “statistical
significance” can be misleading. If you have a small <em>P</em> value,
it <em>only</em> means that the effect being tested is unlikely to be
explained by chance variation alone, in the context of the current study
and the current statistical model underlying the test. If you have a
large <em>P</em> value, it <em>only</em> means that the observed effect
could plausibly be due to chance alone: it is <em>wrong</em> to conclude
that there is no effect.</p>
<p>The American Statistical Association has for some time been
advocating very cautious use of <em>P</em> values (Wasserstein <em>et
al.</em> 2014) because it is too often misinterpreted, and too often
used carelessly. Wasserstein <em>et al.</em> (2019) even goes so far as
to advise against <em>ever</em> using the term “statistically
significant”. The 43 articles it accompanies in the same issue of
<em>TAS</em>, recommend a number of alternatives. I do not agree with
all that is said in the main article, and there are portions that are
too cutesy or wander off-topic. Further, it is quite dizzying to try to
digest all the accompanying articles, and to reconcile their disagreeing
viewpoints. I do agree with one frequent point: that there is really no
substantive difference between <span class="math inline">\(P=.051\)</span> and <span class="math inline">\(P=.049\)</span>, and that one should avoid making
sweeping statements based on a hard cutoff at <span class="math inline">\(P=.05\)</span> or some other value.</p>
<p>For some time I included a summary of Wasserstein <em>et al.</em>’s
recommendations and their <em>ATOM</em> paradigm (Acceptance of
uncertainty, Thoughtfulness, Openness, Modesty). But in the meantime, I
have handled a large number of user questions, and many of those have
made it clear to me that there are more important fish to fry in a
vignette section like this. It is just a fact that <em>P</em> values are
used, and are useful. So I have my own set of recommendations regarding
them.</p>
<div class="section level4">
<h4 id="recs1">A set of comparisons or well-chosen contrasts is more useful and
interpretable than an omnibus <em>F</em> test<a class="anchor" aria-label="anchor" href="#recs1"></a>
</h4>
<!-- @index Recommended practices; Practices, recommended;
     *P* values!Adjusted; *F* test!Role in *post hoc* tests; -->
<p><em>F</em> tests are useful for model selection, but don’t tell you
anything specific about the nature of an effect. If <em>F</em> has a
small <em>P</em> value, it suggests that there is some effect,
somewhere. It doesn’t even necessarily imply that any two means differ
statistically.</p>
</div>
<div class="section level4">
<h4 id="use-adjusted-p-values">Use <em>adjusted</em> <em>P</em> values<a class="anchor" aria-label="anchor" href="#use-adjusted-p-values"></a>
</h4>
<p>When you run a bunch of tests, there is a risk of making too many
type-I errors, and adjusted <em>P</em> values (e.g., the Tukey
adjustment for pairwise comparisons) keep you from making too many
mistakes. That said, it is possible to go overboard; and it’s usually
reasonable to regard each “by” group as a separate family of tests for
purposes of adjustment.</p>
</div>
<div class="section level4">
<h4 id="recs2">It is <em>not</em> necessary to have a significant <em>F</em> test
as a prerequisite to doing comparisons or contrasts<a class="anchor" aria-label="anchor" href="#recs2"></a>
</h4>
<!-- @index LSD!protected; Model!Get it right first -->
<p>… as long as an appropriate adjustment is used. There do exist rules
such as the “protected LSD” by which one is given license to do
unadjusted comparisons provided the <span class="math inline">\(F\)</span> statistic is “significant.” However,
this is a very weak form of protection for which the justification is,
basically, “if <span class="math inline">\(F\)</span> is significant,
you can say absolutely anything you want.”</p>
</div>
<div class="section level4">
<h4 id="get-the-model-right-first">Get the model right first<a class="anchor" aria-label="anchor" href="#get-the-model-right-first"></a>
</h4>
<p>Everything the <strong>emmeans</strong> package does is an
interpretation of the model that you fitted to the data. If the model is
bad, you will get bad results from <code><a href="../reference/emmeans.html">emmeans()</a></code> and other
functions. Every single limitation of your model, be it presuming
constant error variance, omitting interaction terms, etc., becomes a
limitation of the results <code><a href="../reference/emmeans.html">emmeans()</a></code> produces. So do a
responsible job of fitting the model. And if you don’t know what’s meant
by that…</p>
</div>
<div class="section level4">
<h4 id="recs3">Consider seeking the advice of a statistical consultant<a class="anchor" aria-label="anchor" href="#recs3"></a>
</h4>
<!-- @index Statistical consultants; Consultants; Statistics is hard -->
<p>Statistics is <em>hard</em>. It is a lot more than just running
programs and copying output. We began this vignette by emphasizing we
need to start with a good model; that is an artful task, and certainly
what is shown here only hints at what is required; you may need help
with it. It is <em>your</em> research; is it important that it be done
right? Many academic statistics and biostatistics departments can refer
you to someone who can help.</p>
<p><a href="#contents">Back to Contents</a></p>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary of main points<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<ul>
<li>EMMs are derived from a <em>model</em>. A different model for the
same data may lead to different EMMs.</li>
<li>EMMs are based on a <em>reference grid</em> consisting of all
combinations of factor levels, with each covariate set to its average
(by default).</li>
<li>For purposes of defining the reference grid, dimensions of a
multivariate response are treated as levels of a factor.</li>
<li>EMMs are then predictions on this reference grid, or marginal
averages thereof (equally weighted by default).</li>
<li>Reference grids may be modified using <code>at</code> or other
arguments for <code><a href="../reference/ref_grid.html">ref_grid()</a></code>
</li>
<li>Reference grids and <code><a href="../reference/emmeans.html">emmeans()</a></code> results may be plotted
via <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> (for parallel confidence intervals) or
<code><a href="../reference/emmip.html">emmip()</a></code> (for an interaction-style plot).</li>
<li>Be cautious with the terms “significant” and “nonsignificant”, and
don’t ever interpret a “nonsignificant” result as saying that there is
no effect.</li>
<li>Follow good statistical practices such as getting the model right
first, and using adjusted <em>P</em> values for appropriately chosen
families of comparisons or contrasts.</li>
</ul>
<p><a href="#contents">Back to Contents</a></p>
<div class="section level3">
<h3 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<p>Wasserstein RL, Lazar NA (2016) “The ASA’s Statement on
<em>p</em>-Values: Context, Process, and Purpose,” <em>The American
Statistician</em>, <strong>70</strong>, 129–133, <a href="https://doi.org/10.1080/00031305.2016.1154108" class="external-link uri">https://doi.org/10.1080/00031305.2016.1154108</a></p>
<p>Wasserstein RL, Schirm AL, Lazar, NA (2019) “Moving to a World Beyond
‘p &lt; 0.05’,” <em>The American Statistician</em>, <strong>73</strong>,
1–19, <a href="https://doi.org/10.1080/00031305.2019.1583913" class="external-link uri">https://doi.org/10.1080/00031305.2019.1583913</a></p>
</div>
</div>
<div class="section level2">
<h2 id="more">Further reading<a class="anchor" aria-label="anchor" href="#more"></a>
</h2>
<p>The reader is referred to other vignettes for more details and
advanced use. The strings linked below are the names of the vignettes;
i.e., they can also be accessed via
<code>vignette("</code><em>name</em><code>", "emmeans")</code></p>
<ul>
<li>Models that are supported in <strong>emmeans</strong> (there are
lots of them) <a href="models.html">“models”</a>
</li>
<li>Confidence intervals and tests: <a href="confidence-intervals.html">“confidence-intervals”</a>
</li>
<li>Often, users want to compare or contrast EMMs: <a href="comparisons.html">“comparisons”</a>
</li>
<li>Working with response transformations and link functions: <a href="transformations.html">“transformations”</a>
</li>
<li>Multi-factor models with interactions: <a href="interactions.html">“interactions”</a>
</li>
<li>Working with messy data and nested effects: <a href="messy-data.html">“messy-data”</a>
</li>
<li>Making predictions from your model: <a href="predictions.html">“predictions”</a>
</li>
<li>Examples of more sophisticated models (e.g., mixed, ordinal, MCMC)
<a href="sophisticated.html">“sophisticated”</a>
</li>
<li>Utilities for working with <code>emmGrid</code> objects: <a href="utilities.html">“utilities”</a>
</li>
<li>Frequently asked questions: <a href="FAQs.html">“FAQs”</a>
</li>
<li>Adding <strong>emmeans</strong> support to your package: <a href="xtending.html">“xtending”</a>
</li>
</ul>
<p><a href="#contents">Back to Contents</a></p>
<p><a href="vignette-topics.html">Index of all vignette topics</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Russell V. Lenth.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
