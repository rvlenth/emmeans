<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="emmeans">
<title>Transformations and link functions in emmeans • emmeans</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Transformations and link functions in emmeans">
<meta property="og:description" content="emmeans">
<meta property="og:image" content="https://rvlenth.github.io/emmeans/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">emmeans</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.10.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/AQuickStart.html">Quick start guide for **emmeans**</a>
    <a class="dropdown-item" href="../articles/basics.html">Basics of estimated marginal means</a>
    <a class="dropdown-item" href="../articles/comparisons.html">Comparisons and contrasts in emmeans</a>
    <a class="dropdown-item" href="../articles/confidence-intervals.html">Confidence intervals and tests in emmeans</a>
    <a class="dropdown-item" href="../articles/FAQs.html">FAQs for emmeans</a>
    <a class="dropdown-item" href="../articles/interactions.html">Interaction analysis in emmeans</a>
    <a class="dropdown-item" href="../articles/messy-data.html">Working with messy data</a>
    <a class="dropdown-item" href="../articles/models.html">Models supported by emmeans</a>
    <a class="dropdown-item" href="../articles/predictions.html">Prediction in **emmeans**</a>
    <a class="dropdown-item" href="../articles/re-engineering-clds.html">Re-engineering CLDs</a>
    <a class="dropdown-item" href="../articles/sophisticated.html">Sophisticated models in emmeans</a>
    <a class="dropdown-item" href="../articles/transformations.html">Transformations and link functions in emmeans</a>
    <a class="dropdown-item" href="../articles/utilities.html">Utilities and options for emmeans</a>
    <a class="dropdown-item" href="../articles/vignette-topics.html">Index of vignette topics</a>
    <a class="dropdown-item" href="../articles/xplanations.html">Explanations supplement</a>
    <a class="dropdown-item" href="../articles/xtending.html">For developers: Extending **emmeans**</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/rvlenth/emmeans/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Transformations and link functions in emmeans</h1>
                        <h4 data-toc-skip class="author">emmeans
package, Version 1.10.3</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rvlenth/emmeans/blob/HEAD/vignettes/transformations.Rmd" class="external-link"><code>vignettes/transformations.Rmd</code></a></small>
      <div class="d-none name"><code>transformations.Rmd</code></div>
    </div>

    
    
<!-- @index Vignettes!Transformations and link functions -->
<div class="section level2">
<h2 id="contents">Contents<a class="anchor" aria-label="anchor" href="#contents"></a>
</h2>
<p>This vignette covers the intricacies of transformations and link
functions in <strong>emmeans</strong>.</p>
<ol style="list-style-type: decimal">
<li><a href="#overview">Overview</a></li>
<li><a href="#regrid">Re-gridding</a></li>
<li><a href="#links">Link functions</a></li>
<li><a href="#trangraph">Graphing transformations and links</a></li>
<li><a href="#tranlink">Both a response transformation and a
link</a></li>
<li><a href="#special">Special transformations</a></li>
<li><a href="#after">Specifying a transformation after the fact</a></li>
<li><a href="#auto">Auto-detected transformations</a></li>
<li><a href="#stdize">Standardized response</a></li>
<li>
<a href="#logs">Faking a log transformation</a>
<ol style="list-style-type: lower-alpha">
<li><a href="#faking">Faking other transformations</a></li>
<li><a href="#altscale">Alternative scale</a></li>
</ol>
</li>
<li><a href="#bias-adj">Bias adjustment</a></li>
</ol>
<p><a href="vignette-topics.html">Index of all vignette topics</a></p>
</div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<!-- @index Transformations!Overview; Examples!`pigs` -->
<p>Consider an example with the <code>pigs</code> dataset that is used
in many of these vignettes; but this time, we use a <code>log</code>
transformation of the response:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pigs.lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">conc</span><span class="op">)</span> <span class="op">~</span> <span class="va">source</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">percent</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">pigs</span><span class="op">)</span></span></code></pre></div>
<p>This model has two factors, <code>source</code> and
<code>percent</code> (coerced to a factor), as predictors; and
log-transformed <code>conc</code> as the response. Here we obtain the
EMMs for <code>source</code>, examine its structure, and finally produce
a summary, including a test against a null value of log(35):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">emm.src</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">pigs.lm</span>, <span class="st">"source"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">emm.src</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## 'emmGrid' object with variables:</span></span>
<span><span class="co">##     source = fish, soy, skim</span></span>
<span><span class="co">## Transformation: "log"</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">emm.src</span>, infer <span class="op">=</span> <span class="cn">TRUE</span>, null <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">35</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  source emmean     SE df lower.CL upper.CL null t.ratio p.value</span></span>
<span><span class="co">##  fish     3.39 0.0367 23     3.32     3.47 3.56  -4.385  0.0002</span></span>
<span><span class="co">##  soy      3.67 0.0374 23     3.59     3.74 3.56   2.988  0.0066</span></span>
<span><span class="co">##  skim     3.80 0.0394 23     3.72     3.88 3.56   6.130  &lt;.0001</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: percent </span></span>
<span><span class="co">## Results are given on the log (not the response) scale. </span></span>
<span><span class="co">## Confidence level used: 0.95</span></span></code></pre>
<p>Now suppose that we want the EMMs expressed on the same scale as
<code>conc</code>. This can be done by adding
<code>type = "response"</code> to the <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> call:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">emm.src</span>, infer <span class="op">=</span> <span class="cn">TRUE</span>, null <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">35</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  source response   SE df lower.CL upper.CL null t.ratio p.value</span></span>
<span><span class="co">##  fish       29.8 1.09 23     27.6     32.1   35  -4.385  0.0002</span></span>
<span><span class="co">##  soy        39.1 1.47 23     36.2     42.3   35   2.988  0.0066</span></span>
<span><span class="co">##  skim       44.6 1.75 23     41.1     48.3   35   6.130  &lt;.0001</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: percent </span></span>
<span><span class="co">## Confidence level used: 0.95 </span></span>
<span><span class="co">## Intervals are back-transformed from the log scale </span></span>
<span><span class="co">## Tests are performed on the log scale</span></span></code></pre>
<p>Note: Looking ahead, this output is compared later in this vignette
with a <a href="#pigs-biasadj">bias-adjusted version</a>.</p>
<div class="section level3">
<h3 id="timing">Timing is everything<a class="anchor" aria-label="anchor" href="#timing"></a>
</h3>
<!-- @index Transformations!Timing is everything -->
<p>Dealing with transformations in <strong>emmeans</strong> is somewhat
complex, due to the large number of possibilities. But the key is
understanding what happens, when. These results come from a sequence of
steps. Here is what happens (and doesn’t happen) at each step:</p>
<ol style="list-style-type: decimal">
<li>The reference grid is constructed for the <code>log(conc)</code>
model. The fact that a log transformation is used is recorded, but
nothing else is done with that information.</li>
<li>The predictions on the reference grid are averaged over the four
<code>percent</code> levels, for each <code>source</code>, to obtain the
EMMs for <code>source</code> – <em>still</em> on the
<code>log(conc)</code> scale.</li>
<li>The standard errors and confidence intervals for these EMMs are
computed – <em>still</em> on the <code>log(conc)</code> scale.</li>
<li>Only now do we do back-transformation…
<ol style="list-style-type: lower-alpha">
<li>The EMMs are back-transformed to the <code>conc</code> scale.</li>
<li>The endpoints of the confidence intervals are back-transformed.</li>
<li>The <em>t</em> tests and <em>P</em> values are left as-is.</li>
<li>The standard errors are converted to the <code>conc</code> scale
using the delta method. These SEs were <em>not</em> used in constructing
the tests and confidence intervals.</li>
</ol>
</li>
</ol>
</div>
<div class="section level3">
<h3 id="the-model-is-our-best-guide">The model is our best guide<a class="anchor" aria-label="anchor" href="#the-model-is-our-best-guide"></a>
</h3>
<p>This choice of timing is based on the idea that <em>the model is
right</em>. In particular, the fact that the response is transformed
suggests that the transformed scale is the best scale to be working
with. In addition, the model specifies that the effects of
<code>source</code> and <code>percent</code> are <em>linear</em> on the
transformed scale; inasmuch as marginal averaging to obtain EMMs is a
linear operation, that averaging is best done on the transformed scale.
For those two good reasons, back-transforming to the response scale is
delayed until the very end by default.</p>
<p><a href="#contents">Back to Contents</a></p>
</div>
</div>
<div class="section level2">
<h2 id="regrid">Re-gridding<a class="anchor" aria-label="anchor" href="#regrid"></a>
</h2>
<!-- @index `regrid()`; Transformations!Re-gridding; `emmeans()`!With transformations -->
<p>As well-advised as it is, some users may not want the default timing
of things. The tool for changing when back-transformation is performed
is the <code><a href="../reference/regrid.html">regrid()</a></code> function – which, with default settings of
its arguments, back-transforms an <code>emmGrid</code> object and
adjusts everything in it appropriately. For example:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="../reference/regrid.html">regrid</a></span><span class="op">(</span><span class="va">emm.src</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## 'emmGrid' object with variables:</span></span>
<span><span class="co">##     source = fish, soy, skim</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="../reference/regrid.html">regrid</a></span><span class="op">(</span><span class="va">emm.src</span><span class="op">)</span>, infer <span class="op">=</span> <span class="cn">TRUE</span>, null <span class="op">=</span> <span class="fl">35</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  source response   SE df lower.CL upper.CL null t.ratio p.value</span></span>
<span><span class="co">##  fish       29.8 1.09 23     27.5     32.1   35  -4.758  0.0001</span></span>
<span><span class="co">##  soy        39.1 1.47 23     36.1     42.2   35   2.827  0.0096</span></span>
<span><span class="co">##  skim       44.6 1.75 23     40.9     48.2   35   5.446  &lt;.0001</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: percent </span></span>
<span><span class="co">## Confidence level used: 0.95</span></span></code></pre>
<p>Notice that the structure no longer includes the transformation.
That’s because it is no longer relevant; the reference grid is on the
<code>conc</code> scale, and how we got there is now forgotten. Compare
this <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> result with the preceding one, and note the
following:</p>
<ul>
<li>It no longer has annotations concerning transformations.</li>
<li>The estimates and SEs are identical.</li>
<li>The confidence intervals, <em>t</em> ratios, and <em>P</em> values
are <em>not</em> identical. This is because, this time, the SEs shown in
the table are the ones actually used to construct the tests and
intervals.</li>
</ul>
<p>Understood, right? But think carefully about how these EMMs were
obtained. They are back-transformed from <code>emm.src</code>, in which
<em>the marginal averaging was done on the log scale</em>. If we want to
back-transform <em>before</em> doing the averaging, we need to call
<code><a href="../reference/regrid.html">regrid()</a></code> after the reference grid is constructed but before
the averaging takes place:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pigs.rg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ref_grid.html">ref_grid</a></span><span class="op">(</span><span class="va">pigs.lm</span><span class="op">)</span></span>
<span><span class="va">remm.src</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="fu"><a href="../reference/regrid.html">regrid</a></span><span class="op">(</span><span class="va">pigs.rg</span><span class="op">)</span>, <span class="st">"source"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">remm.src</span>, infer <span class="op">=</span> <span class="cn">TRUE</span>, null <span class="op">=</span> <span class="fl">35</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  source response   SE df lower.CL upper.CL null t.ratio p.value</span></span>
<span><span class="co">##  fish       30.0 1.10 23     27.7     32.2   35  -4.585  0.0001</span></span>
<span><span class="co">##  soy        39.4 1.49 23     36.3     42.5   35   2.927  0.0076</span></span>
<span><span class="co">##  skim       44.8 1.79 23     41.1     48.5   35   5.486  &lt;.0001</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: percent </span></span>
<span><span class="co">## Confidence level used: 0.95</span></span></code></pre>
<p>These results all differ from either of the previous two summaries –
again, because the averaging is done on the <code>conc</code> scale
rather than the <code>log(conc)</code> scale.</p>
<div class="section level6">
<h6 id="regrid2"></h6>
<!-- @index `regrid()`!`regrid` vs. `type`; `ref_grid()`!`regrid` argument -->
<p>Note: For those who want to routinely back-transform before
averaging, the <code>regrid</code> argument in <code><a href="../reference/ref_grid.html">ref_grid()</a></code>
simplifies this. The first two steps above could have been done more
easily as follows:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">remm.src</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">pigs.lm</span>, <span class="st">"source"</span>, regrid <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span></code></pre></div>
<p>But don’t get <code>regrid</code> and <code>type</code> confused. The
<code>regrid</code> argument is passed to <code><a href="../reference/regrid.html">regrid()</a></code> (as the
<code>transform</code> argument) after the reference grid is
constructed, whereas the <code>type</code> argument is simply remembered
and used by <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>. So a similar-looking call:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">pigs.lm</span>, <span class="st">"source"</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span></code></pre></div>
<p>will compute the results we have seen for <code>emm.src</code> –
back-transformed <em>after</em> averaging on the log scale.</p>
<p>Remember again: When it comes to transformations, timing is
everything.</p>
</div>
<div class="section level3">
<h3 id="regrid3">Implied regridding with certain modes<a class="anchor" aria-label="anchor" href="#regrid3"></a>
</h3>
<!-- @index Transformations|Special modes; 
             `mode` argument!implied re-gridding; 
             Transformations|Implied re-gridding;
             Re-gridding!Implied-->
<p>Some model classes provide special argument(s) (typically
<code>mode</code>) that may cause transformations or links to be handled
early. For example, cumulative link models for ordinal data allow for a
<code>"prob"</code> mode that produces estimates of probabilities for
each ordinal level. The reference grid comprises estimates on a
probability scale, and whatever link was used (say, probit) has already
been accounted for, so is not “remembered” for possible later
back-transformation. In that sense, when we use
<code>mode = "prob"</code>, it is sort of like an implied call to
<code><a href="../reference/regrid.html">regrid()</a></code> that takes place <em>at the time the reference
grid is constructed</em>, preempting any timing choices you might
otherwise have made about handling the transformation. If there are one
or more factors that are averaged over in estimating marginal means will
be averages of the probabilities in the reference grid; so they will be
different than what you would have obtained by keeping things on the
link scale and then computing the probabilities after averaging on the
link scale.</p>
<p>Similar things happen with certain options with multinomial models,
zero-inflated, or hurdle models. Those special modes are a great
convenience for getting estimates on a scale that is desired, but they
also force you to obtain marginal means of measurements already on that
scale.</p>
<p><a href="#contents">Back to Contents</a></p>
</div>
</div>
<div class="section level2">
<h2 id="links">Link functions<a class="anchor" aria-label="anchor" href="#links"></a>
</h2>
<!-- @index Link functions; Examples!`neuralgia`; Examples!Logistic regression -->
<p>Exactly the same ideas we have presented for response transformations
apply to generalized linear models having non-identity link functions.
As far as <strong>emmeans</strong> is concerned, there is no difference
at all.</p>
<p>To illustrate, consider the <code>neuralgia</code> dataset provided
in the package. These data come from an experiment reported in a SAS
technical report where different treatments for neuralgia are compared.
The patient’s sex is an additional factor, and their age is a covariate.
The response is <code>Pain</code>, a binary variable on whether or not
the patient reports neuralgia pain after treatment. The model suggested
in the SAS report is equivalent to the following. We use it to obtain
estimated probabilities of experiencing pain:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">neuralgia.glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">Pain</span> <span class="op">~</span> <span class="va">Treatment</span> <span class="op">*</span> <span class="va">Sex</span> <span class="op">+</span> <span class="va">Age</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">neuralgia</span><span class="op">)</span></span>
<span><span class="va">neuralgia.emm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">neuralgia.glm</span>, <span class="st">"Treatment"</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## NOTE: Results may be misleading due to involvement in interactions</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">neuralgia.emm</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  Treatment  prob     SE  df asymp.LCL asymp.UCL</span></span>
<span><span class="co">##  A         0.211 0.1109 Inf    0.0675     0.497</span></span>
<span><span class="co">##  B         0.121 0.0835 Inf    0.0285     0.391</span></span>
<span><span class="co">##  P         0.866 0.0883 Inf    0.5927     0.966</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: Sex </span></span>
<span><span class="co">## Confidence level used: 0.95 </span></span>
<span><span class="co">## Intervals are back-transformed from the logit scale</span></span></code></pre>
<div class="section level6">
<h6 id="oddsrats"></h6>
<!-- @index Odds ratios; Logistic regression!Odds ratios -->
<p>(The note about the interaction is discussed shortly.) Note that the
averaging over <code>Sex</code> is done on the logit scale,
<em>before</em> the results are back-transformed for the summary. We may
use <code><a href="https://rdrr.io/r/graphics/pairs.html" class="external-link">pairs()</a></code> to compare these estimates; note that logits
are logs of odds; so this is another instance where log-differences are
back-transformed – in this case to odds ratios:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html" class="external-link">pairs</a></span><span class="op">(</span><span class="va">neuralgia.emm</span>, reverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  contrast odds.ratio     SE  df null z.ratio p.value</span></span>
<span><span class="co">##  B / A         0.513  0.515 Inf    1  -0.665  0.7837</span></span>
<span><span class="co">##  P / A        24.234 25.142 Inf    1   3.073  0.0060</span></span>
<span><span class="co">##  P / B        47.213 57.242 Inf    1   3.179  0.0042</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: Sex </span></span>
<span><span class="co">## P value adjustment: tukey method for comparing a family of 3 estimates </span></span>
<span><span class="co">## Tests are performed on the log odds ratio scale</span></span></code></pre>
<p>So there is evidence of considerably more pain being reported with
placebo (treatment <code>P</code>) than with either of the other two
treatments. The estimated odds of pain with <code>B</code> are about
half that for <code>A</code>, but this finding is not statistically
significant. (The odds that this is a made-up dataset seem quite high,
but that finding is strictly this author’s impression.)</p>
<p>Observe that there is a note in the output for
<code>neuralgia.emm</code> that the results may be misleading. It is
important to take it seriously, because if two factors interact, it may
be the case that marginal averages of predictions don’t reflect what is
happening at any level of the factors being averaged over. To find out,
look at an interaction plot of the fitted model:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emmip.html">emmip</a></span><span class="op">(</span><span class="va">neuralgia.glm</span>, <span class="va">Sex</span> <span class="op">~</span> <span class="va">Treatment</span><span class="op">)</span></span></code></pre></div>
<p><img src="transformations_files/figure-html/unnamed-chunk-12-1.png" alt="Interaction-plot display of the results of emmeans(neuralgia.glm, ~ Treatment | Sex)" width="432">
There is no practical difference between females and males in the
patterns of response to <code>Treatment</code>; so I think most people
would be quite comfortable with the marginal results that are reported
here.</p>
<p>Some users prefer risk ratios (ratios of probabilities) rather than
odds ratios. We will revisit this example <a href="#riskrats">below</a>
after we have discussed some more tools.</p>
<p><a href="#contents">Back to Contents</a></p>
</div>
</div>
<div class="section level2">
<h2 id="trangraph">Graphing transformations and links<a class="anchor" aria-label="anchor" href="#trangraph"></a>
</h2>
<!-- @index Transformations!Graphical display; Examples!`neuralgia`;
    `type = "scale"`; `"scale"` type@scale; -->
<p>There are a few options for displaying transformed results
graphically. First, the <code>type</code> argument works just as it does
in displaying a tabular summary. Following through with the
<code>neuralgia</code> example, let us display the marginal
<code>Treatment</code> EMMs on both the link scale and the response
scale (we are opting to do the averaging on the link scale):</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">neur.Trt.emm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">neuralgia.glm</span>, <span class="st">"Treatment"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">neur.Trt.emm</span><span class="op">)</span>   <span class="co"># Link scale by default</span></span></code></pre></div>
<p><img src="transformations_files/figure-html/unnamed-chunk-13-1.png" alt="Plot A: Display of the results of confint(neur.Trt.emm)" width="432"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">neur.Trt.emm</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span></code></pre></div>
<p><img src="transformations_files/figure-html/unnamed-chunk-13-2.png" alt='Plot B: Display of the results of confint(neur.Trt.emm, type = "response"). These intervals are markedly skewed right|left for low|high estimated probabilities' width="432"></p>
<p>Besides whether or not we see response values, there is a dramatic
difference in the symmetry of the intervals.</p>
<p>For <code><a href="../reference/emmip.html">emmip()</a></code> and <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> <em>only</em> (and
currently only with the “ggplot” engine), there is also the option of
specifying <code>type = "scale"</code>, which causes the response values
to be calculated but plotted on a nonlinear scale corresponding to the
transformation or link:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">neur.Trt.emm</span>, type <span class="op">=</span> <span class="st">"scale"</span><span class="op">)</span></span></code></pre></div>
<p><img src="transformations_files/figure-html/unnamed-chunk-14-1.png" alt="Plot C: On the inside, this plot looks exactly like Plot A above, but the scale is transformed to show the values in Plot B. However, there are not enough tick marks." width="432"></p>
<p>Notice that the interior part of this plot is identical to the plot
on the link scale. Only the horizontal axis is different. That is
because the response values are transformed using the link function to
determine the plotting positions of the graphical elements – putting
them back where they started.</p>
<p>As is the case here, nonlinear scales can be confusing to read, and
it is very often true that you will want to display more scale
divisions, and even add minor ones. This is done via adding arguments
for the function <code><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">ggplot2::scale_x_continuous()</a></code> (see its
documentation):</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">neur.Trt.emm</span>, type <span class="op">=</span> <span class="st">"scale"</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.10</span>, <span class="fl">0.90</span>, by <span class="op">=</span> <span class="fl">0.10</span><span class="op">)</span>,</span>
<span>     minor_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span>, by <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="transformations_files/figure-html/unnamed-chunk-15-1.png" alt="Plot D: Same as Plot C except there are more tick marks so we can discern the values better" width="432"></p>
<p>When using the <code>"ggplot"</code> engine, you always have the
option of using <strong>ggplot2</strong> to incorporate a transformed
scale – and it doesn’t even have to be the same as the transformation
used in the model. For example, here we display the same results on an
arcsin-square-root scale.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">neur.Trt.emm</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/transform_asn.html" class="external-link">asn_trans</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                              breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.10</span>, <span class="fl">0.90</span>, by <span class="op">=</span> <span class="fl">0.10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="transformations_files/figure-html/unnamed-chunk-16-1.png" alt="Plot E: An alternative to Plot D using an arcsin scaling. This scale is less nonlinear than in plot D so the intervals are somewhat skewed, but less so than plot B" width="432"></p>
<p>This comes across as a compromise: not as severe as the logit
scaling, and not as distorted as the linear scaling of response
values.</p>
<p>Again, the same techniques can be used with <code><a href="../reference/emmip.html">emmip()</a></code>,
except it is the vertical scale that is affected.</p>
<p><a href="#contents">Back to Contents</a></p>
</div>
<div class="section level2">
<h2 id="tranlink">Models having both a response transformation and a link
function<a class="anchor" aria-label="anchor" href="#tranlink"></a>
</h2>
<!-- @index Transformations!with link function@link; Examples!`warpbreaks`
            Examples!Gamma regression; `summary()`!`type = "unlink"` -->
<p>It is possible to have a generalized linear model with a non-identity
link <em>and</em> a response transformation. Here is an example, with
the built-in <code>wapbreaks</code> dataset:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">warp.glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">breaks</span><span class="op">)</span> <span class="op">~</span> <span class="va">wool</span><span class="op">*</span><span class="va">tension</span>, family <span class="op">=</span> <span class="va">Gamma</span>, data <span class="op">=</span> <span class="va">warpbreaks</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ref_grid.html">ref_grid</a></span><span class="op">(</span><span class="va">warp.glm</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## 'emmGrid' object with variables:</span></span>
<span><span class="co">##     wool = A, B</span></span>
<span><span class="co">##     tension = L, M, H</span></span>
<span><span class="co">## Transformation: "inverse" </span></span>
<span><span class="co">## Additional response transformation: "sqrt"</span></span></code></pre>
<p>The canonical link for a gamma model is the reciprocal (or inverse);
and there is the square-root response transformation besides. If we
choose <code>type = "response"</code> in summarizing, we undo
<em>both</em> transformations:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">warp.glm</span>, <span class="op">~</span> <span class="va">tension</span> <span class="op">|</span> <span class="va">wool</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## wool = A:</span></span>
<span><span class="co">##  tension response   SE df lower.CL upper.CL</span></span>
<span><span class="co">##  L           42.9 5.24 48     34.0     55.7</span></span>
<span><span class="co">##  M           23.3 2.85 48     18.5     30.3</span></span>
<span><span class="co">##  H           23.6 2.88 48     18.7     30.7</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## wool = B:</span></span>
<span><span class="co">##  tension response   SE df lower.CL upper.CL</span></span>
<span><span class="co">##  L           27.4 3.35 48     21.8     35.7</span></span>
<span><span class="co">##  M           28.1 3.43 48     22.3     36.5</span></span>
<span><span class="co">##  H           18.5 2.26 48     14.7     24.1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Confidence level used: 0.95 </span></span>
<span><span class="co">## Intervals are back-transformed from the sqrt[inverse] scale</span></span></code></pre>
<p>What happened here is first the linear predictor was back-transformed
from the link scale (inverse); then the squares were obtained to
back-transform the rest of the way. It is possible to undo the link, and
not the response transformation:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">warp.glm</span>, <span class="op">~</span> <span class="va">tension</span> <span class="op">|</span> <span class="va">wool</span>, type <span class="op">=</span> <span class="st">"unlink"</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## wool = A:</span></span>
<span><span class="co">##  tension response    SE df lower.CL upper.CL</span></span>
<span><span class="co">##  L           6.55 0.400 48     5.83     7.46</span></span>
<span><span class="co">##  M           4.83 0.295 48     4.30     5.50</span></span>
<span><span class="co">##  H           4.86 0.297 48     4.33     5.54</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## wool = B:</span></span>
<span><span class="co">##  tension response    SE df lower.CL upper.CL</span></span>
<span><span class="co">##  L           5.24 0.320 48     4.67     5.97</span></span>
<span><span class="co">##  M           5.30 0.324 48     4.72     6.04</span></span>
<span><span class="co">##  H           4.30 0.263 48     3.83     4.90</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Confidence level used: 0.95 </span></span>
<span><span class="co">## Intervals are back-transformed from the inverse scale</span></span></code></pre>
<p>It is <em>not</em> possible to undo the response transformation and
leave the link in place, because the response was transform first, then
the link model was applied; we have to undo those in reverse order to
make sense.</p>
<p>One may also use <code>"unlink"</code> as a <code>transform</code>
argument in <code><a href="../reference/regrid.html">regrid()</a></code> or through
<code><a href="../reference/ref_grid.html">ref_grid()</a></code>.</p>
<p><a href="#contents">Back to Contents</a></p>
</div>
<div class="section level2">
<h2 id="special">Special transformations<a class="anchor" aria-label="anchor" href="#special"></a>
</h2>
<!-- @index Transformations!Custom; `make.tran()` -->
<p>The <code><a href="../reference/make.tran.html">make.tran()</a></code> function provides several special
transformations and sets things up so they can be handled in
<strong>emmeans</strong> with relative ease. (See
<code><a href="../reference/make.tran.html">help("make.tran", "emmeans")</a></code> for descriptions of what is
available.) <code><a href="../reference/make.tran.html">make.tran()</a></code> works much like
<code><a href="https://rdrr.io/r/stats/make.link.html" class="external-link">stats::make.link()</a></code> in that it returns a list of functions
<code>linkfun()</code>, <code>linkinv()</code>, etc. that serve in
managing results on a transformed scale. The difference is that most
transformations with <code><a href="../reference/make.tran.html">make.tran()</a></code> require additional
arguments.</p>
<p>To use this capability in <code><a href="../reference/emmeans.html">emmeans()</a></code>, it is fortuitous to
first obtain the <code><a href="../reference/make.tran.html">make.tran()</a></code> result, and then to use it as
the enclosing environment for fitting the model, with
<code>linkfun</code> as the transformation. For example, suppose the
response variable is a percentage and we want to use the response
transformation <span class="math inline">\(\sin^{-1}\sqrt{y/100}\)</span>. Then proceed like
this:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tran</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make.tran.html">make.tran</a></span><span class="op">(</span><span class="st">"asin.sqrt"</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">my.model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">tran</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="fu">linkfun</span><span class="op">(</span><span class="va">percent</span><span class="op">)</span> <span class="op">~</span> <span class="va">treatment</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">Block</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mydata</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Subsequent calls to <code><a href="../reference/ref_grid.html">ref_grid()</a></code>, <code><a href="../reference/emmeans.html">emmeans()</a></code>,
<code><a href="../reference/regrid.html">regrid()</a></code>, etc. will then be able to access the
transformation information correctly.</p>
<p>The help page for <code><a href="../reference/make.tran.html">make.tran()</a></code> has an example like this
using a Box-Cox transformation.</p>
<p><a href="#contents">Back to Contents</a></p>
</div>
<div class="section level2">
<h2 id="after">Specifying a transformation after the fact<a class="anchor" aria-label="anchor" href="#after"></a>
</h2>
<!-- @index Transformations!Adding after the fact; `update()`!`tran` -->
<p>It is not at all uncommon to fit a model using statements like the
following:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">mydata</span>, logy.5 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">yield</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">my.model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">logy.5</span> <span class="op">~</span> <span class="va">treatment</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">Block</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mydata</span><span class="op">)</span></span></code></pre></div>
<p>In this case, there is no way for <code><a href="../reference/ref_grid.html">ref_grid()</a></code> to figure
out that a response transformation was used. What can be done is to
update the reference grid with the required information:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my.rg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="fu"><a href="../reference/ref_grid.html">ref_grid</a></span><span class="op">(</span><span class="va">my.model</span><span class="op">)</span>, tran <span class="op">=</span> <span class="fu"><a href="../reference/make.tran.html">make.tran</a></span><span class="op">(</span><span class="st">"genlog"</span>, <span class="fl">.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Subsequently, use <code>my.rg</code> in place of
<code>my.model</code> in any <code><a href="../reference/emmeans.html">emmeans()</a></code> analyses, and the
transformation information will be there.</p>
<p>For standard transformations (those in
<code><a href="https://rdrr.io/r/stats/make.link.html" class="external-link">stats::make.link()</a></code>), just give the name of the
transformation; e.g.,</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model.rg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="fu"><a href="../reference/ref_grid.html">ref_grid</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span>, tran <span class="op">=</span> <span class="st">"sqrt"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="auto">Auto-detected response transformations<a class="anchor" aria-label="anchor" href="#auto"></a>
</h2>
<!-- @index Transformations!Auto-detected -->
<p>As can be seen in the initial <code>pigs.lm</code> example in this
vignette, certain straightforward response transformations such as
<code>log</code>, <code>sqrt</code>, etc. are automatically detected
when <code><a href="../reference/emmeans.html">emmeans()</a></code> (really, <code><a href="../reference/ref_grid.html">ref_grid()</a></code>) is called
on the model object. In fact, scaling and shifting is supported too; so
the preceding example with <code>my.model</code> could have been done
more easily by specifying the transformation directly in the model
formula:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my.better.model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">yield</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">~</span> <span class="va">treatment</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">Block</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mydata</span><span class="op">)</span></span></code></pre></div>
<p>The transformation would be auto-detected, saving you the trouble of
adding it later. Similarly, a response transformation of
<code>2 * sqrt(y + 1)</code> would be correctly auto-detected. A model
with a linearly transformed response, e.g. <code>4*(y - 1)</code>, would
<em>not</em> be auto-detected, but <code>4*I(y + -1)</code> would be
interpreted as <code>4*identity(y + -1)</code>. Parsing is such that the
response expression must be of the form
<code>mult * fcn(resp + const)</code>; operators of <code>-</code> and
<code>/</code> are not recognized.</p>
<p><a href="#contents">Back to Contents</a></p>
</div>
<div class="section level2">
<h2 id="logs">Faking a log transformation<a class="anchor" aria-label="anchor" href="#logs"></a>
</h2>
<!-- @index Transformations!Faking a log transformation; `regrid()`!`transform = "log"` -->
<p>The <code><a href="../reference/regrid.html">regrid()</a></code> function makes it possible to fake a log
transformation of the response. Why would you want to do this? So that
you can make comparisons using ratios instead of differences.</p>
<p>Consider the <code>pigs</code> example once again, but suppose we had
fitted a model with a square-root transformation instead of a log:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pigroot.lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">conc</span><span class="op">)</span> <span class="op">~</span> <span class="va">source</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">percent</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">pigs</span><span class="op">)</span></span>
<span><span class="va">logemm.src</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regrid.html">regrid</a></span><span class="op">(</span><span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">pigroot.lm</span>, <span class="st">"source"</span><span class="op">)</span>, transform <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">logemm.src</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  source response   SE df lower.CL upper.CL</span></span>
<span><span class="co">##  fish       29.8 1.32 23     27.2     32.7</span></span>
<span><span class="co">##  soy        39.2 1.54 23     36.2     42.6</span></span>
<span><span class="co">##  skim       45.0 1.74 23     41.5     48.7</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: percent </span></span>
<span><span class="co">## Confidence level used: 0.95 </span></span>
<span><span class="co">## Intervals are back-transformed from the log scale</span></span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html" class="external-link">pairs</a></span><span class="op">(</span><span class="va">logemm.src</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  contrast    ratio     SE df null t.ratio p.value</span></span>
<span><span class="co">##  fish / soy  0.760 0.0454 23    1  -4.591  0.0004</span></span>
<span><span class="co">##  fish / skim 0.663 0.0391 23    1  -6.965  &lt;.0001</span></span>
<span><span class="co">##  soy / skim  0.872 0.0469 23    1  -2.548  0.0457</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: percent </span></span>
<span><span class="co">## P value adjustment: tukey method for comparing a family of 3 estimates </span></span>
<span><span class="co">## Tests are performed on the log scale</span></span></code></pre>
<p>These results are not identical, but very similar to the
back-transformed confidence intervals <a href="#timing">above</a> for
the EMMs and the <a href="comparisons.html#logs">pairwise ratios in the
“comparisons” vignette</a>, where the fitted model actually used a log
response.</p>
<div class="section level3">
<h3 id="faking">Faking other transformations<a class="anchor" aria-label="anchor" href="#faking"></a>
</h3>
<!-- @index Transformations!faking -->
<p>It is possible to fake transformations other than the log. Just use
the same method, e.g. (results not displayed)</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/regrid.html">regrid</a></span><span class="op">(</span><span class="va">emm</span>, transform <span class="op">=</span> <span class="st">"probit"</span><span class="op">)</span></span></code></pre></div>
<p>would re-grid the existing <code>emm</code> to the probit scale. Note
that any estimates in <code>emm</code> outside of the interval <span class="math inline">\((0,1)\)</span> will be flagged as
non-estimable.</p>
<p>The <a href="#stdize">section on standardized responses</a> gives an
example of reverse-engineering a standardized response transformation in
this way.</p>
</div>
<div class="section level3">
<h3 id="riskrats">Revisiting the neuralgia example<a class="anchor" aria-label="anchor" href="#riskrats"></a>
</h3>
<!-- @index Risk ratios; Logistic regression!Risk ratios;
            `regrid()`!to obtain risk ratios;  -->
<p>As was mentioned before in the <a href="#links"><code>neuralgia</code> example</a>, some users prefer
ratios of probabilities (risk ratios) rather than odds ratios. The
additional machinery of <code><a href="../reference/regrid.html">regrid()</a></code> makes this possible.
First, do</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">log.emm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regrid.html">regrid</a></span><span class="op">(</span><span class="va">neuralgia.emm</span>, <span class="st">"log"</span><span class="op">)</span></span></code></pre></div>
<p>While each node of <code>neuralgia.emm</code> is an estimate of the
logit of a probability, the corresponding nodes of <code>log.emm</code>
are estimates of the log of the same probability. Thus, pairwise
comparisons are differences of logs, which are logs of ratios. The risk
ratios are thus obtainable by</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html" class="external-link">pairs</a></span><span class="op">(</span><span class="va">log.emm</span>, reverse <span class="op">=</span> <span class="cn">TRUE</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  contrast ratio    SE  df null z.ratio p.value</span></span>
<span><span class="co">##  B / A    0.572 0.484 Inf    1  -0.661  0.7863</span></span>
<span><span class="co">##  P / A    4.107 2.221 Inf    1   2.613  0.0244</span></span>
<span><span class="co">##  P / B    7.181 5.185 Inf    1   2.730  0.0174</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: Sex </span></span>
<span><span class="co">## P value adjustment: tukey method for comparing a family of 3 estimates </span></span>
<span><span class="co">## Tests are performed on the log scale</span></span></code></pre>
<p>The test statistics and P values differ somewhat from those for the
odds ratios because they are computed on the log scale rather than the
original logit scale.</p>
<div class="section level6">
<h6 id="not-logit"></h6>
<!-- @index Logistic-like regression!Non-logit links; 
   `regrid()`!probit or other lon-logit models;
  Probit regression!Odds or risk ratios -->
<p>We were able to obtain both odds ratios and risk ratios for
<code>neuralgia.glm</code>. But what if we had not used the logit link?
Then the odds ratios would not just fall out naturally. However, we can
<code><a href="../reference/regrid.html">regrid()</a></code> to the <code>"logit"</code> scale if we want odds
ratios, or to <code>"log"</code> scale if we want risk ratios. For
example,</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">neuralgia.prb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">Pain</span> <span class="op">~</span> <span class="va">Treatment</span> <span class="op">*</span> <span class="va">Sex</span> <span class="op">+</span> <span class="va">Age</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"probit"</span><span class="op">)</span>, </span>
<span>                     data <span class="op">=</span> <span class="va">neuralgia</span><span class="op">)</span></span>
<span><span class="va">prb.emm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">neuralgia.prb</span>, <span class="st">"Treatment"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html" class="external-link">pairs</a></span><span class="op">(</span><span class="fu"><a href="../reference/regrid.html">regrid</a></span><span class="op">(</span><span class="va">prb.emm</span>, <span class="st">"logit"</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"response"</span>, reverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  contrast odds.ratio     SE  df null z.ratio p.value</span></span>
<span><span class="co">##  B / A         0.517  0.509 Inf    1  -0.670  0.7809</span></span>
<span><span class="co">##  P / A        15.561 14.358 Inf    1   2.975  0.0082</span></span>
<span><span class="co">##  P / B        30.077 33.225 Inf    1   3.081  0.0058</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: Sex </span></span>
<span><span class="co">## P value adjustment: tukey method for comparing a family of 3 estimates </span></span>
<span><span class="co">## Tests are performed on the log odds ratio scale</span></span></code></pre>
<p>These are vaguely comparable to the odds ratios we obtained with
<code>neuralgia.glm</code>, Similar re-gridding for the log will give us
risk ratios.</p>
</div>
</div>
<div class="section level3">
<h3 id="altscale">Alternative scale<a class="anchor" aria-label="anchor" href="#altscale"></a>
</h3>
<!-- @index Transformations!Percent difference; Percentage differences; Examples!`pigs` -->
<p>It is possible to create a report on an alternative scale by updating
the <code>tran</code> component. For example, suppose we want percent
differences instead of ratios in the preceding example with the
<code>pigs</code> dataset. This is possible by modifying the reverse
transformation: since the usual reverse transformation is a ratio of the
form <span class="math inline">\(r = a/b\)</span>, we have that the
percentage difference between <span class="math inline">\(a\)</span> and
<span class="math inline">\(b\)</span> is <span class="math inline">\(100(a-b)/b = 100(r-1)\)</span>. Thus,</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pct.diff.tran</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    linkfun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">mu</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">mu</span><span class="op">/</span><span class="fl">100</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    linkinv <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">eta</span><span class="op">)</span> <span class="fl">100</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    mu.eta <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">eta</span><span class="op">)</span> <span class="fl">100</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta</span><span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"log(pct.diff)"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html" class="external-link">pairs</a></span><span class="op">(</span><span class="va">logemm.src</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>, </span>
<span>       tran <span class="op">=</span> <span class="va">pct.diff.tran</span>, inv.lbl <span class="op">=</span> <span class="st">"pct.diff"</span>, adjust <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>       infer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  contrast    pct.diff   SE df lower.CL upper.CL t.ratio p.value</span></span>
<span><span class="co">##  fish / soy     -24.0 4.54 23    -32.8   -13.97  -4.591  0.0001</span></span>
<span><span class="co">##  fish / skim    -33.7 3.91 23    -41.3   -25.08  -6.965  &lt;.0001</span></span>
<span><span class="co">##  soy / skim     -12.8 4.69 23    -22.0    -2.54  -2.548  0.0180</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: percent </span></span>
<span><span class="co">## Confidence level used: 0.95 </span></span>
<span><span class="co">## Intervals are back-transformed from the log(pct.diff) scale </span></span>
<span><span class="co">## Tests are performed on the log(pct.diff) scale</span></span></code></pre>
<p>Another way to obtain the same estimates is to directly transform the
estimated ratios to <span class="math inline">\(100r - 100\)</span>:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/contrast.html">contrast</a></span><span class="op">(</span><span class="fu"><a href="../reference/regrid.html">regrid</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html" class="external-link">pairs</a></span><span class="op">(</span><span class="va">logemm.src</span><span class="op">)</span><span class="op">)</span>, <span class="st">"identity"</span>, scale <span class="op">=</span> <span class="fl">100</span>, offset <span class="op">=</span> <span class="op">-</span><span class="fl">100</span>,</span>
<span>         infer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  contrast    estimate   SE df lower.CL upper.CL t.ratio p.value</span></span>
<span><span class="co">##  (fish/soy)     -24.0 4.54 23    -33.3    -14.6  -5.281  &lt;.0001</span></span>
<span><span class="co">##  (fish/skim)    -33.7 3.91 23    -41.8    -25.6  -8.613  &lt;.0001</span></span>
<span><span class="co">##  (soy/skim)     -12.8 4.69 23    -22.5     -3.1  -2.730  0.0119</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: percent </span></span>
<span><span class="co">## Confidence level used: 0.95</span></span></code></pre>
<p>While the estimates are the same, the tests and confidence intervals
are different because they are computed on the re-gridded scale using
the standard errors shown, rather than on the link scale as in the first
results.</p>
</div>
</div>
<div class="section level2">
<h2 id="stdize">Standardized response<a class="anchor" aria-label="anchor" href="#stdize"></a>
</h2>
<!-- @index Transformations!Standardizing; Transformations!`scale()`;
    `scale()`; Standardized response; Examples!`fiber`; `regrid` argument -->
<p>In some disciplines, it is common to fit a model to a standardized
response variable. R’s base function <code><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale()</a></code> makes this
easy to do; but it is important to notice that <code>scale(y)</code> is
more complicated than, say, <code>sqrt(y)</code>, because
<code>scale(y)</code> requires all the values of <code>y</code> in order
to determine the centering and scaling parameters. The
<code><a href="../reference/ref_grid.html">ref_grid()</a></code> function (called by `emmeans() and others) tries
to detect the scaling parameters. To illustrate:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fiber.lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">strength</span><span class="op">)</span> <span class="op">~</span> <span class="va">machine</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">diameter</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">fiber</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">fiber.lm</span>, <span class="st">"machine"</span><span class="op">)</span>   <span class="co"># on the standardized scale</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  machine   emmean    SE df lower.CL upper.CL</span></span>
<span><span class="co">##  A        0.00444 0.156  9   -0.349    0.358</span></span>
<span><span class="co">##  B        0.28145 0.172  9   -0.109    0.672</span></span>
<span><span class="co">##  C       -0.33473 0.194  9   -0.774    0.105</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are given on the scale(40.2, 4.97) (not the response) scale. </span></span>
<span><span class="co">## Confidence level used: 0.95</span></span></code></pre>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">fiber.lm</span>, <span class="st">"machine"</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>   <span class="co"># strength scale</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  machine response    SE df lower.CL upper.CL</span></span>
<span><span class="co">##  A           40.2 0.777  9     38.5     42.0</span></span>
<span><span class="co">##  B           41.6 0.858  9     39.7     43.5</span></span>
<span><span class="co">##  C           38.5 0.966  9     36.3     40.7</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Confidence level used: 0.95 </span></span>
<span><span class="co">## Intervals are back-transformed from the scale(40.2, 4.97) scale</span></span></code></pre>
<p>More interesting (and complex) is what happens with
<code><a href="../reference/emtrends.html">emtrends()</a></code>. Without anything fancy added, we have</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emtrends.html">emtrends</a></span><span class="op">(</span><span class="va">fiber.lm</span>, <span class="st">"machine"</span>, var <span class="op">=</span> <span class="st">"diameter"</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  machine diameter.trend     SE df lower.CL upper.CL</span></span>
<span><span class="co">##  A                0.222 0.0389  9   0.1339    0.310</span></span>
<span><span class="co">##  B                0.172 0.0450  9   0.0705    0.274</span></span>
<span><span class="co">##  C                0.174 0.0418  9   0.0791    0.268</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Confidence level used: 0.95</span></span></code></pre>
<p>These slopes are (change in <code>scale(strength)</code>) / (change
in <code>diameter</code>); that is, we didn’t do anything to undo the
response transformation, but the trend is based on exactly the variable
specified, <code>diameter</code>. To get (change in
<code>strength</code>) / (change in <code>diameter</code>), we need to
undo the response transformation, and that is done via
<code>regrid</code> (which invokes <code><a href="../reference/regrid.html">regrid()</a></code> after the
reference grid is constructed):</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emtrends.html">emtrends</a></span><span class="op">(</span><span class="va">fiber.lm</span>, <span class="st">"machine"</span>, var <span class="op">=</span> <span class="st">"diameter"</span>, regrid <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  machine diameter.trend    SE df lower.CL upper.CL</span></span>
<span><span class="co">##  A                1.104 0.194  9    0.666     1.54</span></span>
<span><span class="co">##  B                0.857 0.224  9    0.351     1.36</span></span>
<span><span class="co">##  C                0.864 0.208  9    0.394     1.33</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Confidence level used: 0.95</span></span></code></pre>
<p>What if we want slopes for (change in <code>scale(strength)</code>) /
(change in <code>scale(diameter)</code>)? This can be done, but it is
necessary to manually specify the scaling parameters for
<code>diameter</code>.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">fiber</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">diameter</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">diameter</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##      mean        sd </span></span>
<span><span class="co">## 24.133333  4.323799</span></span></code></pre>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emtrends.html">emtrends</a></span><span class="op">(</span><span class="va">fiber.lm</span>, <span class="st">"machine"</span>, var <span class="op">=</span> <span class="st">"scale(diameter, 24.133, 4.324)"</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  machine scale(diameter, 24.133, 4.324).trend    SE df lower.CL upper.CL</span></span>
<span><span class="co">##  A                                      0.960 0.168  9    0.579     1.34</span></span>
<span><span class="co">##  B                                      0.745 0.195  9    0.305     1.19</span></span>
<span><span class="co">##  C                                      0.751 0.181  9    0.342     1.16</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Confidence level used: 0.95</span></span></code></pre>
<p>This result is the one most directly related to the regression
coefficients:</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fiber.lm</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##          scale(diameter) machineB:scale(diameter) machineC:scale(diameter) </span></span>
<span><span class="co">##                0.9598846               -0.2148202               -0.2086880</span></span></code></pre>
<p>There is a fourth possibility, (change in <code>strength</code>) /
(change in <code>scale(diameter)</code>), that I leave to the
reader.</p>
<div class="section level3">
<h3 id="what-to-do-if-auto-detection-fails">What to do if auto-detection fails<a class="anchor" aria-label="anchor" href="#what-to-do-if-auto-detection-fails"></a>
</h3>
<p>Auto-detection of standardized responses is a bit tricky, and doesn’t
always succeed. If it fails, a message is displayed and the
transformation is ignored. In cases where it doesn’t work, we need to
explicitly specify the transformation using <code><a href="../reference/make.tran.html">make.tran()</a></code>.
The methods are exactly as shown earlier in this vignette, so we show
the code but not the results for a hypothetical example.</p>
<p>One method is to fit the model and then add the transformation
information later. In this example, <code>some.fcn</code> is a
model-fitting function which for some reason doesn’t allow the scaling
information to be detected.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">some.fcn</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">RT</span><span class="op">)</span> <span class="op">~</span> <span class="va">group</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">subject</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mydata</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">mod</span>, <span class="st">"group"</span>, type <span class="op">=</span> <span class="st">"response"</span>,</span>
<span>        tran <span class="op">=</span> <span class="fu"><a href="../reference/make.tran.html">make.tran</a></span><span class="op">(</span><span class="st">"scale"</span>, y <span class="op">=</span> <span class="va">mydata</span><span class="op">$</span><span class="va">RT</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The other, equivalent, method is to create the transformation object
first and use it in fitting the model:</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="../reference/make.tran.html">make.tran</a></span><span class="op">(</span><span class="st">"scale"</span>, y <span class="op">=</span> <span class="va">mydata</span><span class="op">$</span><span class="va">RT</span><span class="op">)</span>,</span>
<span>            <span class="fu">some.fcn</span><span class="op">(</span><span class="fu">linkfun</span><span class="op">(</span><span class="va">RT</span><span class="op">)</span> <span class="op">~</span> <span class="va">group</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">subject</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mydata</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">mod</span>, <span class="st">"group"</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="reverse-engineering-a-standardized-response">Reverse-engineering a standardized response<a class="anchor" aria-label="anchor" href="#reverse-engineering-a-standardized-response"></a>
</h3>
<p>An interesting twist on all this is the reverse situation: Suppose we
fitted the model <em>without</em> the standardized response, but we want
to know what the results would be if we had standardized. Here we
reverse-engineer the <code>fiber.lm</code> example above:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fib.lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">strength</span> <span class="op">~</span> <span class="va">machine</span> <span class="op">*</span> <span class="va">diameter</span>, data <span class="op">=</span> <span class="va">fiber</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># On raw scale:</span></span>
<span><span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">fib.lm</span>, <span class="st">"machine"</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  machine emmean    SE df lower.CL upper.CL</span></span>
<span><span class="co">##  A         40.2 0.777  9     38.5     42.0</span></span>
<span><span class="co">##  B         41.6 0.858  9     39.7     43.5</span></span>
<span><span class="co">##  C         38.5 0.966  9     36.3     40.7</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Confidence level used: 0.95</span></span></code></pre>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># On standardized scale:</span></span>
<span><span class="va">tran</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make.tran.html">make.tran</a></span><span class="op">(</span><span class="st">"scale"</span>, y <span class="op">=</span> <span class="va">fiber</span><span class="op">$</span><span class="va">strength</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">fib.lm</span>, <span class="st">"machine"</span>, regrid <span class="op">=</span> <span class="va">tran</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  machine   emmean    SE df lower.CL upper.CL</span></span>
<span><span class="co">##  A        0.00444 0.156  9   -0.349    0.358</span></span>
<span><span class="co">##  B        0.28145 0.172  9   -0.109    0.672</span></span>
<span><span class="co">##  C       -0.33473 0.194  9   -0.774    0.105</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are given on the scale(40.2, 4.97) (not the response) scale. </span></span>
<span><span class="co">## Confidence level used: 0.95</span></span></code></pre>
<p>In the latter call, the <code>regrid</code> argument causes
<code><a href="../reference/regrid.html">regrid()</a></code> to be called after the reference grid is
constructed.</p>
<p><a href="#contents">Back to Contents</a></p>
</div>
</div>
<div class="section level2">
<h2 id="bias-adj">Bias adjustment<a class="anchor" aria-label="anchor" href="#bias-adj"></a>
</h2>
<!-- @index Transformations!Bias adjustment; Bias adjustment!When back-transforming;
    Means!Generalized; Geometric means; -->
<p>So far, we have discussed ideas related to back-transforming results
as a simple way of expressing results on the same scale as the response.
In particular, means obtained in this way are known as <em>generalized
means</em>; for example, a log transformation of the response is
associated with geometric means. When the goal is simply to make
inferences about which means are less than which other means, and a
response transformation is used, it is often acceptable to present
estimates and comparisons of these generalized means. However, sometimes
it is important to report results that actually do reflect expected
values of the untransformed response. An example is a financial study,
where the response is in some monetary unit. It may be convenient to use
a response transformation for modeling purposes, but ultimately we may
want to make financial projections in those same units.</p>
<p>In such settings, we need to make a bias adjustment when we
back-transform, because any nonlinear transformation biases the expected
values of statistical quantities. More specifically, suppose that we
have a response <span class="math inline">\(Y\)</span> and the
transformed response is <span class="math inline">\(U\)</span>. To
back-transform, we use <span class="math inline">\(Y = h(U)\)</span>;
and using a Taylor approximation, <span class="math inline">\(Y \approx
h(\eta) + h'(\eta)(U-\eta) +
\frac12h''(\eta)(U-\eta)^2\)</span>, so that <span class="math inline">\(E(Y) \approx h(\eta) +
\frac12h''(\eta)Var(U)\)</span>. This shows that the amount of
needed bias adjustment is approximately <span class="math inline">\(\frac12h''(\eta)\sigma^2\)</span> where
<span class="math inline">\(\sigma\)</span> is the error SD in the model
for <span class="math inline">\(U\)</span>. It depends on <span class="math inline">\(\sigma\)</span>, and the larger this is, the
greater the bias adjustment is needed. This second-order bias adjustment
is what is currently used in the <strong>emmeans</strong> package when
bias-adjustment is requested. There are better or exact adjustments for
certain cases, and future updates may incorporate some of those.</p>
<div class="section level3">
<h3 id="pigs-biasadj">Pigs example revisited<a class="anchor" aria-label="anchor" href="#pigs-biasadj"></a>
</h3>
<!-- @index Examples!`pigs` -->
<p>Let us compare the estimates in <a href="#overview">the overview</a>
after we apply a bias adjustment. First, note that an estimate of the
residual SD is available via the <code><a href="https://rdrr.io/r/stats/sigma.html" class="external-link">sigma()</a></code> function:</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/sigma.html" class="external-link">sigma</a></span><span class="op">(</span><span class="va">pigs.lm</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## [1] 0.115128</span></span></code></pre>
<p>This estimate is used by default. The bias-adjusted EMMs for the
sources are:</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">emm.src</span>, type <span class="op">=</span> <span class="st">"response"</span>, bias.adj <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  source response   SE df lower.CL upper.CL</span></span>
<span><span class="co">##  fish       30.0 1.10 23     27.8     32.4</span></span>
<span><span class="co">##  soy        39.4 1.48 23     36.5     42.6</span></span>
<span><span class="co">##  skim       44.9 1.77 23     41.3     48.7</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: percent </span></span>
<span><span class="co">## Confidence level used: 0.95 </span></span>
<span><span class="co">## Intervals are back-transformed from the log scale </span></span>
<span><span class="co">## Bias adjustment applied based on sigma = 0.11513</span></span></code></pre>
<p>These estimates (and also their SEs) are slightly larger than we had
without bias adjustment. They are estimates of the <em>arithmetic</em>
mean responses, rather than the <em>geometric</em> means shown in the
overview. Had the value of <code>sigma</code> been larger, the
adjustment would have been greater. You can experiment with this by
adding a <code>sigma =</code> argument to the above call.</p>
</div>
<div class="section level3">
<h3 id="link-bias">Response transformations vs. link functions<a class="anchor" aria-label="anchor" href="#link-bias"></a>
</h3>
<!-- @index Transformations!Response versus link functions;
    Bias adjustment!For link functions vs. response transformations; -->
<p>At this point, it is important to point out that the above discussion
focuses on <em>response</em> transformations, as opposed to link
functions used in generalized linear models (GLMs). In an ordinary GLM,
no bias adjustment is needed, nor is it appropriate, because the link
function is just used to define a nonlinear relationship between the
actual response mean <span class="math inline">\(\eta\)</span> and the
linear predictor. That is, the back-transformed parameter is already the
mean.</p>
<div class="section level4">
<h4 id="insects">InsectSprays example<a class="anchor" aria-label="anchor" href="#insects"></a>
</h4>
<!-- @index Examples!`InsectSprays`;  Bias adjustment!When *not* to use; -->
<p>To illustrate this, consider the <code>InsectSprays</code> data in
the <strong>datasets</strong> package. The response variable is a count,
and there is one treatment, the spray that is used. Let us model the
count as a Poisson variable with (by default) a log link; and obtain the
EMMs, with and without a bias adjustment</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ismod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">spray</span>, data <span class="op">=</span> <span class="va">InsectSprays</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">ismod</span>, <span class="st">"spray"</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  spray  rate    SE  df asymp.LCL asymp.UCL</span></span>
<span><span class="co">##  A     14.50 1.099 Inf     12.50     16.82</span></span>
<span><span class="co">##  B     15.33 1.130 Inf     13.27     17.72</span></span>
<span><span class="co">##  C      2.08 0.417 Inf      1.41      3.08</span></span>
<span><span class="co">##  D      4.92 0.640 Inf      3.81      6.35</span></span>
<span><span class="co">##  E      3.50 0.540 Inf      2.59      4.74</span></span>
<span><span class="co">##  F     16.67 1.179 Inf     14.51     19.14</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Confidence level used: 0.95 </span></span>
<span><span class="co">## Intervals are back-transformed from the log scale</span></span></code></pre>
<p>The above results were computed with no bias adjustment, the default.
If you try</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">ismod</span>, <span class="st">"spray"</span>, type <span class="op">=</span> <span class="st">"response"</span>, bias.adj <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>you will get exactly the same results, plus a warning message that
says bias adjustment was disabled. Why? Because in an ordinary GLM like
this, we are <em>already</em> modeling the mean counts, and the link
function is not a response transformation as such, just a part of the
relationship we are specifying between the linear predictor and the
mean. Given the simple structure of this dataset, we can verify this by
noting that the estimates we have correspond examply to the simple
observed mean counts:</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">InsectSprays</span>, <span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">count</span>, <span class="va">spray</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##         A         B         C         D         E         F </span></span>
<span><span class="co">## 14.500000 15.333333  2.083333  4.916667  3.500000 16.666667</span></span></code></pre>
<p>The point here is that a GLM does not have an additive error term,
that the model is already formulated in terms of the mean, not some
generalized mean. (You can enable the bias-adjustment computations by
specifying a valid <code>sigma</code> value; but you should not do
so.)</p>
<p>Note that, in a generalized linear <em>mixed</em> model, including
generalized estimating equations and such, there <em>are</em> additive
random components involved, and then bias adjustment becomes
appropriate.</p>
</div>
<div class="section level4">
<h4 id="cbpp">CBPP example<a class="anchor" aria-label="anchor" href="#cbpp"></a>
</h4>
<!-- @index Examples!`cbpp`; Bias adjustment!In GLMMs and GEE models; -->
<p>Consider an example adapted from the help page for
<code><a href="https://rdrr.io/pkg/lme4/man/cbpp.html" class="external-link">lme4::cbpp</a></code>. Contagious bovine pleuropneumonia (CBPP) is a
disease in African cattle, and the dataset contains data on incidence of
CBPP in several herds of cattle over four time periods. We will fit a
mixed model that accounts for herd variations as well as overdispersion
(variations larger than expected with a simple binomial model):</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/" class="external-link">lme4</a></span><span class="op">)</span></span>
<span><span class="va">cbpp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">cbpp</span>, unit <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cbpp</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cbpp.glmer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/glmer.html" class="external-link">glmer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">incidence</span>, <span class="va">size</span> <span class="op">-</span> <span class="va">incidence</span><span class="op">)</span> <span class="op">~</span> <span class="va">period</span> <span class="op">+</span> </span>
<span>                          <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">herd</span><span class="op">)</span> <span class="op">+</span>  <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">unit</span><span class="op">)</span>,</span>
<span>                    family <span class="op">=</span> <span class="va">binomial</span>, data <span class="op">=</span> <span class="va">cbpp</span><span class="op">)</span></span>
<span></span>
<span><span class="va">emm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">cbpp.glmer</span>, <span class="st">"period"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">emm</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  period   prob     SE  df asymp.LCL asymp.UCL</span></span>
<span><span class="co">##  1      0.1824 0.0442 Inf    0.1109    0.2852</span></span>
<span><span class="co">##  2      0.0614 0.0230 Inf    0.0290    0.1252</span></span>
<span><span class="co">##  3      0.0558 0.0220 Inf    0.0254    0.1182</span></span>
<span><span class="co">##  4      0.0334 0.0172 Inf    0.0120    0.0894</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Confidence level used: 0.95 </span></span>
<span><span class="co">## Intervals are back-transformed from the logit scale</span></span></code></pre>
<p>The above summary reflects the back-transformed estimates, with no
bias adjustment. However, the model estimates two independent sources of
random variation that probably should be taken into account:</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lme4</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html" class="external-link">VarCorr</a></span><span class="op">(</span><span class="va">cbpp.glmer</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  Groups Name        Std.Dev.</span></span>
<span><span class="co">##  unit   (Intercept) 0.89107 </span></span>
<span><span class="co">##  herd   (Intercept) 0.18396</span></span></code></pre>
<p>Notably, the over-dispersion SD is considerably greater than the herd
SD. Suppose we want to estimate the marginal probabilities of CBPP
incidence, averaged over herds and over-dispersion variations. For this
purpose, we need the combined effect of these variations; so we compute
the overall SD via the Pythagorean theorem:</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">total.SD</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">0.89107</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">0.18396</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>Accordingly, here are the bias-adjusted estimates of the marginal
probabilities:</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">emm</span>, type <span class="op">=</span> <span class="st">"response"</span>, bias.adjust <span class="op">=</span> <span class="cn">TRUE</span>, sigma <span class="op">=</span> <span class="va">total.SD</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  period   prob     SE  df asymp.LCL asymp.UCL</span></span>
<span><span class="co">##  1      0.2216 0.0462 Inf    0.1426     0.321</span></span>
<span><span class="co">##  2      0.0823 0.0292 Inf    0.0400     0.159</span></span>
<span><span class="co">##  3      0.0751 0.0282 Inf    0.0351     0.151</span></span>
<span><span class="co">##  4      0.0458 0.0230 Inf    0.0168     0.117</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Confidence level used: 0.95 </span></span>
<span><span class="co">## Intervals are back-transformed from the logit scale </span></span>
<span><span class="co">## Bias adjustment applied based on sigma = 0.90986</span></span></code></pre>
<p>These estimates are somewhat larger than the unadjusted estimates
(actually, any estimates greater than 0.5 would have been adjusted
downward). These adjusted estimates are more appropriate for describing
the marginal incidence of CBPP for all herds. In fact, these estimates
are fairly close to those obtained directly from the incidences in the
data:</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">cbpp</span>, <span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">incidence</span>, <span class="va">period</span>, <span class="va">sum</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">trials</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">cbpp</span>, <span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">size</span>, <span class="va">period</span>, <span class="va">sum</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cases</span> <span class="op">/</span> <span class="va">trials</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##          1          2          3          4 </span></span>
<span><span class="co">## 0.21942446 0.08018868 0.07106599 0.04516129</span></span></code></pre>
<p>Left as an exercise: Revisit the <code>InsectSprays</code> example,
but (using similar methods to the above) create a <code>unit</code>
variable and fit an over-dispersion model. Compare the results with and
without bias adjustment, and evaluate these results against the earlier
results. This is simpler than the CBPP example because there is only one
random effect.</p>
<p><a href="#contents">Back to Contents</a></p>
<p><a href="vignette-topics.html">Index of all vignette topics</a></p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Russell V. Lenth.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
