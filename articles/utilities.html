<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Utilities and options for emmeans • emmeans</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Utilities and options for emmeans">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">emmeans</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/AQuickStart.html">Quick start guide for **emmeans**</a></li>
    <li><a class="dropdown-item" href="../articles/basics.html">Basics of estimated marginal means</a></li>
    <li><a class="dropdown-item" href="../articles/comparisons.html">Comparisons and contrasts in emmeans</a></li>
    <li><a class="dropdown-item" href="../articles/confidence-intervals.html">Confidence intervals and tests in emmeans</a></li>
    <li><a class="dropdown-item" href="../articles/FAQs.html">FAQs for emmeans</a></li>
    <li><a class="dropdown-item" href="../articles/interactions.html">Interaction analysis in emmeans</a></li>
    <li><a class="dropdown-item" href="../articles/messy-data.html">Working with messy data</a></li>
    <li><a class="dropdown-item" href="../articles/models.html">Models supported by emmeans</a></li>
    <li><a class="dropdown-item" href="../articles/predictions.html">Prediction in **emmeans**</a></li>
    <li><a class="dropdown-item" href="../articles/re-engineering-clds.html">Re-engineering CLDs</a></li>
    <li><a class="dropdown-item" href="../articles/sophisticated.html">Sophisticated models in emmeans</a></li>
    <li><a class="dropdown-item" href="../articles/transformations.html">Transformations and link functions in emmeans</a></li>
    <li><a class="dropdown-item" href="../articles/utilities.html">Utilities and options for emmeans</a></li>
    <li><a class="dropdown-item" href="../articles/vignette-topics.html">Index of vignette topics</a></li>
    <li><a class="dropdown-item" href="../articles/xplanations.html">Explanations supplement</a></li>
    <li><a class="dropdown-item" href="../articles/xtending.html">For developers: Extending **emmeans**</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rvlenth/emmeans/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Utilities and options for emmeans</h1>
                        <h4 data-toc-skip class="author">emmeans
package, Version 2.0.0</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rvlenth/emmeans/blob/master/vignettes/utilities.Rmd" class="external-link"><code>vignettes/utilities.Rmd</code></a></small>
      <div class="d-none name"><code>utilities.Rmd</code></div>
    </div>

    
    
<!-- @index Vignettes!Utilities and options -->
<div class="section level2">
<h2 id="contents">Contents<a class="anchor" aria-label="anchor" href="#contents"></a>
</h2>
<ol style="list-style-type: decimal">
<li><a href="#update">Updating an <code>emmGrid</code> object</a></li>
<li>
<a href="#options">Setting options</a>
<ol style="list-style-type: lower-alpha">
<li><a href="#defaults">Setting and viewing defaults</a></li>
<li><a href="#digits">Optimal digits to display</a></li>
<li><a href="#startup">Startup options</a></li>
</ol>
</li>
<li><a href="#rbind">Combining and subsetting <code>emmGrid</code>
objects</a></li>
<li><a href="#data">Accessing results to use elsewhere</a></li>
<li><a href="#groups">Adding grouping factors</a></li>
<li><a href="#relevel">Re-labeling and re-leveling an
<code>emmGrid</code></a></li>
</ol>
<p><a href="vignette-topics.html">Index of all vignette topics</a></p>
</div>
<div class="section level2">
<h2 id="update">Updating an <code>emmGrid</code> object<a class="anchor" aria-label="anchor" href="#update"></a>
</h2>
<!-- @index `update()`; `emmGrid` objects!Modifying -->
<p>Several internal settings are saved when functions like
<code><a href="../reference/ref_grid.html">ref_grid()</a></code>, <code><a href="../reference/emmeans.html">emmeans()</a></code>,
<code><a href="../reference/contrast.html">contrast()</a></code>, etc. are run. Those settings can be manipulated
via the <code><a href="https://rdrr.io/r/stats/update.html" class="external-link">update()</a></code> method for <code>emmGrid</code>s. To
illustrate, consider the <code>pigs</code> dataset and model yet
again:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pigs.lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">conc</span><span class="op">)</span> <span class="op">~</span> <span class="va">source</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">percent</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">pigs</span><span class="op">)</span></span>
<span><span class="va">pigs.emm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">pigs.lm</span>, <span class="st">"source"</span><span class="op">)</span></span>
<span><span class="va">pigs.emm</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  source emmean     SE df lower.CL upper.CL</span></span>
<span><span class="co">##  fish     3.39 0.0367 23     3.32     3.47</span></span>
<span><span class="co">##  soy      3.67 0.0374 23     3.59     3.74</span></span>
<span><span class="co">##  skim     3.80 0.0394 23     3.72     3.88</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: percent </span></span>
<span><span class="co">## Results are given on the log (not the response) scale. </span></span>
<span><span class="co">## Confidence level used: 0.95</span></span></code></pre>
<p>We see confidence intervals but not tests, by default. This happens
as a result of internal settings in <code>pigs.emm.s</code> that are
passed to <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> when the object is displayed. If we are
going to work with this object a lot, we might want to change its
internal settings rather than having to rely on explicitly calling
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> with several arguments. If so, just update the
internal settings to what is desired; for example:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pigs.emm.s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">pigs.emm</span>, infer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span><span class="op">)</span>, null <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">35</span><span class="op">)</span>,</span>
<span>                     calc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>n <span class="op">=</span> <span class="st">".wgt."</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pigs.emm.s</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  source emmean     SE df  n lower.CL upper.CL null t.ratio p.value</span></span>
<span><span class="co">##  fish     3.39 0.0367 23 10     3.32     3.47 3.56  -4.385  0.0002</span></span>
<span><span class="co">##  soy      3.67 0.0374 23 10     3.59     3.74 3.56   2.988  0.0066</span></span>
<span><span class="co">##  skim     3.80 0.0394 23  9     3.72     3.88 3.56   6.130  &lt;.0001</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: percent </span></span>
<span><span class="co">## Results are given on the log (not the response) scale. </span></span>
<span><span class="co">## Confidence level used: 0.95</span></span></code></pre>
<p>Note that by adding of <code>calc</code>, we have set a default to
calculate and display the sample size when the object is summarized. See
<code><a href="../reference/update.emmGrid.html">help("update.emmGrid")</a></code> for details on the keywords that can
be changed. Mostly, they are the same as the names of arguments in the
functions that construct these objects.</p>
<p>Of course, we can always get what we want via calls to
<code><a href="../reference/summary.emmGrid.html">test()</a></code>, <code><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint()</a></code> or <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>
with appropriate arguments. But the <code><a href="https://rdrr.io/r/stats/update.html" class="external-link">update()</a></code> function is
more useful in sophisticated manipulations of objects, or called
implicitly via the <code>...</code> or <code>options</code> argument in
<code><a href="../reference/emmeans.html">emmeans()</a></code> and other functions. Those options are passed to
<code><a href="https://rdrr.io/r/stats/update.html" class="external-link">update()</a></code> just before the object is returned. For example,
we could have done the above update within the <code><a href="../reference/emmeans.html">emmeans()</a></code>
call as follows (results are not shown because they are the same as
before):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">pigs.lm</span>, <span class="st">"source"</span>, infer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span><span class="op">)</span>, null <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">35</span><span class="op">)</span>,</span>
<span>        calc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>n <span class="op">=</span> <span class="st">".wgt."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><a href="#contents">Back to contents</a></p>
</div>
<div class="section level2">
<h2 id="options">Setting options<a class="anchor" aria-label="anchor" href="#options"></a>
</h2>
<!-- @index `get_emm_option()`; Options -->
<p>Speaking of the <code>options</code> argument, note that the default
in <code><a href="../reference/emmeans.html">emmeans()</a></code> is
<code>options = get_emm_option("emmeans")</code>. Let’s see what that
is:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emm_options.html">get_emm_option</a></span><span class="op">(</span><span class="st">"emmeans"</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## $infer</span></span>
<span><span class="co">## [1]  TRUE FALSE</span></span></code></pre>
<p>So, by default, confidence intervals, but not tests, are displayed
when the result is summarized. The reverse is true for results of
<code><a href="../reference/contrast.html">contrast()</a></code> (and also the default for <code><a href="https://rdrr.io/r/graphics/pairs.html" class="external-link">pairs()</a></code>
which calls <code><a href="../reference/contrast.html">contrast()</a></code>):</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emm_options.html">get_emm_option</a></span><span class="op">(</span><span class="st">"contrast"</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## $infer</span></span>
<span><span class="co">## [1] FALSE  TRUE</span></span></code></pre>
<p>There are also defaults for a newly constructed reference grid:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emm_options.html">get_emm_option</a></span><span class="op">(</span><span class="st">"ref_grid"</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## $is.new.rg</span></span>
<span><span class="co">## [1] TRUE</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $infer</span></span>
<span><span class="co">## [1] FALSE FALSE</span></span></code></pre>
<p>The default is to display neither intervals nor tests when
summarizing. In addition, the flag <code>is.new.rg</code> is set to
<code>TRUE</code>, and that is why one sees a <code><a href="https://rdrr.io/r/utils/str.html" class="external-link">str()</a></code> listing
rather than a summary as the default when the object is simply shown by
typing its name at the console.</p>
<div class="section level3">
<h3 id="defaults">Setting and viewing defaults<a class="anchor" aria-label="anchor" href="#defaults"></a>
</h3>
<!-- @index `emm_options()`; `emmGrid` objects!Setting defaults for
     `emmeans()`!Changing defaults; `contrast()`!Changing defaults -->
<p>The user may have other preferences. She may want to see both
intervals and tests whenever contrasts are produced; and perhaps she
also wants to always default to the response scale when transformations
or links are present. We can change the defaults by setting the
corresponding options; and that is done via the
<code><a href="../reference/emm_options.html">emm_options()</a></code> function:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emm_options.html">emm_options</a></span><span class="op">(</span>emmeans <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>,</span>
<span>            contrast <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>infer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now, new <code><a href="../reference/emmeans.html">emmeans()</a></code> results and contrasts follow the new
defaults:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pigs.anal.p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">pigs.lm</span>, <span class="va">consec</span> <span class="op">~</span> <span class="va">percent</span><span class="op">)</span></span>
<span><span class="va">pigs.anal.p</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## $emmeans</span></span>
<span><span class="co">##  percent response   SE df lower.CL upper.CL</span></span>
<span><span class="co">##        9     31.4 1.28 23     28.8     34.1</span></span>
<span><span class="co">##       12     37.5 1.44 23     34.7     40.6</span></span>
<span><span class="co">##       15     39.0 1.70 23     35.6     42.7</span></span>
<span><span class="co">##       18     42.3 2.24 23     37.9     47.2</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: source </span></span>
<span><span class="co">## Confidence level used: 0.95 </span></span>
<span><span class="co">## Intervals are back-transformed from the log scale </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $contrasts</span></span>
<span><span class="co">##  contrast              ratio     SE df lower.CL upper.CL null t.ratio p.value</span></span>
<span><span class="co">##  percent12 / percent9   1.20 0.0671 23    1.038     1.38    1   3.202  0.0110</span></span>
<span><span class="co">##  percent15 / percent12  1.04 0.0604 23    0.896     1.20    1   0.650  0.8613</span></span>
<span><span class="co">##  percent18 / percent15  1.09 0.0750 23    0.911     1.29    1   1.194  0.5201</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: source </span></span>
<span><span class="co">## Confidence level used: 0.95 </span></span>
<span><span class="co">## Conf-level adjustment: mvt method for 3 estimates </span></span>
<span><span class="co">## Intervals are back-transformed from the log scale </span></span>
<span><span class="co">## P value adjustment: mvt method for 3 tests </span></span>
<span><span class="co">## Tests are performed on the log scale</span></span></code></pre>
<p>Observe that the contrasts “inherited” the
<code>type = "response"</code> default from the EMMs.</p>
<p>NOTE: Setting the above options does <em>not</em> change how existing
<code>emmGrid</code> objects are displayed; it only affects ones
constructed in the future.</p>
<p>There is one more option – <code>summary</code> – that overrides all
other display defaults for both existing and future objects. For
example, specifying
<code>emm_options(summary = list(infer = c(TRUE, TRUE)))</code> will
result in both intervals and tests being displayed, regardless of their
internal defaults, unless <code>infer</code> is explicitly specified in
a call to <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>.</p>
<p>To temporarily revert to factory defaults in a single call to
<code><a href="../reference/emmeans.html">emmeans()</a></code> or <code><a href="../reference/contrast.html">contrast()</a></code> or
<code><a href="https://rdrr.io/r/graphics/pairs.html" class="external-link">pairs()</a></code>, specify <code>options = NULL</code> in the call.
To reset everything to factory defaults (which we do presently),
null-out all of the <strong>emmeans</strong> package options:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>emmeans <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="digits">Optimal digits to display<a class="anchor" aria-label="anchor" href="#digits"></a>
</h3>
<!-- @index Digits, optimizing; `opt.digits` option -->
<p>When an <code>emmGrid</code> object is summarized and displayed, the
factory default is to display it with just enough digits as is justified
by the standard errors or HPD intervals of the estimates displayed. You
may use the <code>"opt.digits"</code> option to change this. If it is
<code>TRUE</code> (the default), we display only enough digits as is
justified (but at least 3). If it is set to <code>FALSE</code>, the
number of digits is set using the R system’s default,
<code>getOption("digits")</code>; this is often much more precision than
is justified. To illustrate, here is the summary of
<code>pigs.emm</code> displayed without optimizing digits. Compare it
with the first summary in this vignette.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emm_options.html">emm_options</a></span><span class="op">(</span>opt.digits <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">pigs.emm</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  source   emmean         SE df lower.CL upper.CL</span></span>
<span><span class="co">##  fish   3.394492 0.03668122 23 3.318612 3.470373</span></span>
<span><span class="co">##  soy    3.667260 0.03744798 23 3.589793 3.744727</span></span>
<span><span class="co">##  skim   3.796770 0.03938283 23 3.715300 3.878240</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: percent </span></span>
<span><span class="co">## Results are given on the log (not the response) scale. </span></span>
<span><span class="co">## Confidence level used: 0.95</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emm_options.html">emm_options</a></span><span class="op">(</span>opt.digits <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>  <span class="co"># revert to optimal digits</span></span></code></pre></div>
<p>By the way, setting this option does <em>not</em> round the
calculated values computed by <code><a href="../reference/summary.emmGrid.html">summary.emmGrid()</a></code> or saved in
a <code>summary)emm</code> object; it simply controls the precision
displayed by <code>print.summary_emm()</code>.</p>
</div>
<div class="section level3">
<h3 id="startup">Startup options<a class="anchor" aria-label="anchor" href="#startup"></a>
</h3>
<!-- @index Startup options; Options!Startup -->
<p>The options accessed by <code><a href="../reference/emm_options.html">emm_options()</a></code> and
<code><a href="../reference/emm_options.html">get_emm_option()</a></code> are stored in a list named
<code>emmeans</code> within R’s options environment. Therefore, if you
desire options other than the defaults provided on a regular basis, this
can be easily arranged by specifying them in your startup script for R.
For example, if you want to default to Satterthwaite degrees of freedom
for <code>lmer</code> models, and display confidence intervals rather
than tests for contrasts, your <code>.Rprofile</code> file could contain
the line</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>emmeans <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lmer.df <span class="op">=</span> <span class="st">"satterthwaite"</span>, </span>
<span>                       contrast <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>infer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><a href="#contents">Back to contents</a></p>
</div>
</div>
<div class="section level2">
<h2 id="rbind">Combining and subsetting <code>emmGrid</code> objects<a class="anchor" aria-label="anchor" href="#rbind"></a>
</h2>
<!-- @index `emmGrid` objects!Combining and subsetting
     `rbind()`; `+` operator@plus -->
<p>Two or more <code>emmGrid</code> objects may be combined using the
<code><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind()</a></code> or <code>+</code> methods. The most common reason
(or perhaps the only good reason) to do this is to combine EMMs or
contrasts into one family for purposes of applying a multiplicity
adjustment to tests or intervals. A user may want to combine the three
pairwise comparisons of sources with the three comparisons above of
consecutive percents into a single family of six tests with a suitable
multiplicity adjustment. This is done quite simply:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html" class="external-link">pairs</a></span><span class="op">(</span><span class="va">pigs.emm.s</span><span class="op">)</span>, <span class="va">pigs.anal.p</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  contrast              estimate     SE df t.ratio p.value</span></span>
<span><span class="co">##  fish - soy             -0.2728 0.0529 23  -5.153  0.0002</span></span>
<span><span class="co">##  fish - skim            -0.4023 0.0542 23  -7.428  &lt;.0001</span></span>
<span><span class="co">##  soy - skim             -0.1295 0.0530 23  -2.442  0.1364</span></span>
<span><span class="co">##  percent12 - percent9    0.1796 0.0561 23   3.202  0.0238</span></span>
<span><span class="co">##  percent15 - percent12   0.0378 0.0582 23   0.650  1.0000</span></span>
<span><span class="co">##  percent18 - percent15   0.0825 0.0691 23   1.194  1.0000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over some or all of the levels of: percent, source </span></span>
<span><span class="co">## Results are given on the log (not the response) scale. </span></span>
<span><span class="co">## P value adjustment: bonferroni method for 6 tests</span></span></code></pre>
<p>The default adjustment is <code>"bonferroni"</code>; we could have
specified something different via the <code>adjust</code> argument. An
equivalent way to combine <code>emmGrid</code>s is via the addition
operator. Any options may be provided by <code><a href="https://rdrr.io/r/stats/update.html" class="external-link">update()</a></code>. Below,
we combine the same results into a family but ask for the “exact”
multiplicity adjustment.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">pigs.anal.p</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html" class="external-link">pairs</a></span><span class="op">(</span><span class="va">pigs.emm.s</span><span class="op">)</span>, adjust <span class="op">=</span> <span class="st">"mvt"</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  contrast              ratio     SE df lower.CL upper.CL null t.ratio p.value</span></span>
<span><span class="co">##  percent12 / percent9  1.197 0.0671 23    1.022    1.402    1   3.202  0.0213</span></span>
<span><span class="co">##  percent15 / percent12 1.039 0.0604 23    0.881    1.224    1   0.650  0.9680</span></span>
<span><span class="co">##  percent18 / percent15 1.086 0.0750 23    0.894    1.320    1   1.194  0.7306</span></span>
<span><span class="co">##  fish / soy            0.761 0.0403 23    0.656    0.884    1  -5.153  0.0002</span></span>
<span><span class="co">##  fish / skim           0.669 0.0362 23    0.574    0.779    1  -7.428  &lt;.0001</span></span>
<span><span class="co">##  soy / skim            0.879 0.0466 23    0.756    1.020    1  -2.442  0.1111</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over some or all of the levels of: source, percent </span></span>
<span><span class="co">## Confidence level used: 0.95 </span></span>
<span><span class="co">## Conf-level adjustment: mvt method for 6 estimates </span></span>
<span><span class="co">## Intervals are back-transformed from the log scale </span></span>
<span><span class="co">## P value adjustment: mvt method for 6 tests </span></span>
<span><span class="co">## Tests are performed on the log scale</span></span></code></pre>
<p>Also evident in comparing these results is that settings are obtained
from the first object combined. So in the second output, where they are
combined in reverse order, we get both confidence intervals and tests,
and transformation to the response scale.</p>
<div class="section level6">
<h6 id="brackets"></h6>
<!-- @index Selecting results; Brackets (`[ ]` and `[[ ]]` operators) -->
<p>To subset an <code>emmGrid</code> object, just use the subscripting
operator <code>[]</code>. For instance,</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pigs.emm</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  source emmean     SE df lower.CL upper.CL</span></span>
<span><span class="co">##  soy      3.67 0.0374 23     3.59     3.74</span></span>
<span><span class="co">##  skim     3.80 0.0394 23     3.72     3.88</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: percent </span></span>
<span><span class="co">## Results are given on the log (not the response) scale. </span></span>
<span><span class="co">## Confidence level used: 0.95</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="data">Accessing results to use elsewhere<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<!-- @index `emmGrid` objects!Accessing data; Using results 
     `summary_emm` object!As a data frame; Digits!Displaying more digits;
     Precision!Displaying results with more digits; -->
<p>Sometimes, users want to use the results of an analysis (say, an
<code><a href="../reference/emmeans.html">emmeans()</a></code> call) in other computations. The
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> method creates a <code>summary_emm</code> object
that inherits from the <code>data.frame</code> class; so one may use the
variables therein just as those in a data frame.</p>
<p>An <code>emmGrid</code> object has its own internal structure and we
can’t directly access the values we see displayed. If follow-up
computations are needed, use <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> (or
<code><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint()</a></code> or <code><a href="../reference/summary.emmGrid.html">test()</a></code>), creates a
<code>summary_emm</code> object which inherits from
<code>data.frame</code> – making it possible to access the values. For
illustration, let’s add the widths of the confidence intervals in our
example.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CIs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">pigs.emm</span><span class="op">)</span></span>
<span><span class="va">CIs</span><span class="op">$</span><span class="va">CI.width</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">CIs</span>, <span class="va">upper.CL</span> <span class="op">-</span> <span class="va">lower.CL</span><span class="op">)</span></span>
<span><span class="va">CIs</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  source emmean     SE df lower.CL upper.CL CI.width</span></span>
<span><span class="co">##  fish     3.39 0.0367 23     3.32     3.47    0.152</span></span>
<span><span class="co">##  soy      3.67 0.0374 23     3.59     3.74    0.155</span></span>
<span><span class="co">##  skim     3.80 0.0394 23     3.72     3.88    0.163</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: percent </span></span>
<span><span class="co">## Results are given on the log (not the response) scale. </span></span>
<span><span class="co">## Confidence level used: 0.95</span></span></code></pre>
<p>By the way, the values stored internally are kept to full precision,
more than is typically displayed:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CIs</span><span class="op">$</span><span class="va">emmean</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## [1] 3.394492 3.667260 3.796770</span></span></code></pre>
<p>If you want to display more digits, specify so using the
<code>print</code> method:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">CIs</span>, digits <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  source emmean       SE df lower.CL upper.CL CI.width</span></span>
<span><span class="co">##  fish   3.3945 0.036681 23   3.3186   3.4704  0.15176</span></span>
<span><span class="co">##  soy    3.6673 0.037448 23   3.5898   3.7447  0.15493</span></span>
<span><span class="co">##  skim   3.7968 0.039383 23   3.7153   3.8782  0.16294</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: percent </span></span>
<span><span class="co">## Results are given on the log (not the response) scale. </span></span>
<span><span class="co">## Confidence level used: 0.95</span></span></code></pre>
<p><a href="#contents">Back to contents</a></p>
</div>
<div class="section level2">
<h2 id="groups">Adding grouping factors<a class="anchor" aria-label="anchor" href="#groups"></a>
</h2>
<!-- @index Grouping factors; `add_grouping()`; Nesting factors!Creating  -->
<p>Sometimes, users want to group levels of a factor into a smaller
number of groups. Those groups may then be, say, averaged separately and
compared, or used as a <code>by</code> factor. The
<code><a href="../reference/manip-factors.html">add_grouping()</a></code> function serves this purpose. The function
takes four arguments: the object, the name of the grouping factor to be
created, the name of the reference factor that is being grouped, and a
vector of level names of the grouping factor corresponding to levels of
the reference factor. Suppose for example that we want to distinguish
animal and non-animal sources of protein in the <code>pigs</code>
example:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pigs.emm.ss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/manip-factors.html">add_grouping</a></span><span class="op">(</span><span class="va">pigs.emm.s</span>, <span class="st">"type"</span>, <span class="st">"source"</span>,</span>
<span>                            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"animal"</span>, <span class="st">"vegetable"</span>, <span class="st">"animal"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">pigs.emm.ss</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## 'emmGrid' object with variables:</span></span>
<span><span class="co">##     source = fish, soy, skim</span></span>
<span><span class="co">##     type = animal, vegetable</span></span>
<span><span class="co">## Nesting structure:  source %in% type</span></span>
<span><span class="co">## Transformation: "log"</span></span></code></pre>
<p>Note that the new object has a nesting structure (see more about this
in the <a href="messy-data.html#nesting">“messy-data” vignette</a>),
with the reference factor nested in the new grouping factor. Now we can
obtain means and comparisons for each group</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">pigs.emm.ss</span>, <span class="va">pairwise</span> <span class="op">~</span> <span class="va">type</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## $emmeans</span></span>
<span><span class="co">##  type      emmean     SE df  n lower.CL upper.CL</span></span>
<span><span class="co">##  animal      3.60 0.0267 23 19     3.54     3.65</span></span>
<span><span class="co">##  vegetable   3.67 0.0374 23 10     3.59     3.74</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: percent, source </span></span>
<span><span class="co">## Results are given on the log (not the response) scale. </span></span>
<span><span class="co">## Confidence level used: 0.95 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $contrasts</span></span>
<span><span class="co">##  contrast           estimate     SE df t.ratio p.value</span></span>
<span><span class="co">##  animal - vegetable  -0.0716 0.0455 23  -1.573  0.1295</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results are averaged over the levels of: percent, source </span></span>
<span><span class="co">## Results are given on the log (not the response) scale.</span></span></code></pre>
<p><a href="#contents">Back to contents</a></p>
</div>
<div class="section level2">
<h2 id="relevel">Re-labeling or re-leveling an <code>emmGrid</code><a class="anchor" aria-label="anchor" href="#relevel"></a>
</h2>
<!-- @index Re-labeling; Levels!Changing; Labels!Changing; Examples!`warpbreaks`;
    Examples!Welch's *t* comparisons; Welch's *t* comparisons!Example    -->
<p>Sometimes it is desirable to re-label the rows of an
<code>emmGrid</code>, or cast it in terms of other factor(s). This can
be done via the <code>levels</code> argument in
<code><a href="https://rdrr.io/r/stats/update.html" class="external-link">update()</a></code>.</p>
<p>As an example, sometimes a fitted model has a treatment factor that
comprises combinations of other factors. In subsequent analysis, we may
well want to break it down into the individual factors’ contributions.
Consider, for example, the <code>warpbreaks</code> data provided with R.
We will define a single factor and fit a non homogeneous-variance
model:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">warp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">warpbreaks</span>, treat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">wool</span>, <span class="va">tension</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/nlme/" class="external-link">nlme</a></span><span class="op">)</span></span>
<span><span class="va">warp.gls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/gls.html" class="external-link">gls</a></span><span class="op">(</span><span class="va">breaks</span> <span class="op">~</span> <span class="va">treat</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/varIdent.html" class="external-link">varIdent</a></span><span class="op">(</span>form <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span><span class="op">|</span><span class="va">treat</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">warp</span><span class="op">)</span></span>
<span><span class="op">(</span> <span class="va">warp.emm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">warp.gls</span>, <span class="st">"treat"</span><span class="op">)</span> <span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">##  treat emmean   SE   df lower.CL upper.CL</span></span>
<span><span class="co">##  A.L     44.6 6.03 7.97     30.6     58.5</span></span>
<span><span class="co">##  B.L     28.2 3.29 8.00     20.6     35.8</span></span>
<span><span class="co">##  A.M     24.0 2.89 8.00     17.3     30.7</span></span>
<span><span class="co">##  B.M     28.8 3.14 8.00     21.5     36.0</span></span>
<span><span class="co">##  A.H     24.6 3.42 8.00     16.7     32.5</span></span>
<span><span class="co">##  B.H     18.8 1.63 8.00     15.0     22.5</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Degrees-of-freedom method: satterthwaite </span></span>
<span><span class="co">## Confidence level used: 0.95</span></span></code></pre>
<p>But now we want to re-cast this <code>emmGrid</code> into one that
has separate factors for <code>wool</code> and <code>tension</code>. We
can do this as follows:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">warp.fac</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">warp.emm</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                wool <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>, tension <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"L"</span>, <span class="st">"M"</span>, <span class="st">"H"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">warp.fac</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## 'emmGrid' object with variables:</span></span>
<span><span class="co">##     wool = A, B</span></span>
<span><span class="co">##     tension = L, M, H</span></span></code></pre>
<p>So now we can do various contrasts involving the separate
factors:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/contrast.html">contrast</a></span><span class="op">(</span><span class="va">warp.fac</span>, <span class="st">"consec"</span>, by <span class="op">=</span> <span class="st">"wool"</span><span class="op">)</span></span></code></pre></div>
<pre class="ro"><code><span><span class="co">## wool = A:</span></span>
<span><span class="co">##  contrast estimate   SE   df t.ratio p.value</span></span>
<span><span class="co">##  M - L     -20.556 6.69 11.4  -3.074  0.0203</span></span>
<span><span class="co">##  H - M       0.556 4.48 15.6   0.124  0.9899</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## wool = B:</span></span>
<span><span class="co">##  contrast estimate   SE   df t.ratio p.value</span></span>
<span><span class="co">##  M - L       0.556 4.55 16.0   0.122  0.9881</span></span>
<span><span class="co">##  H - M     -10.000 3.54 12.0  -2.824  0.0269</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Degrees-of-freedom method: satterthwaite </span></span>
<span><span class="co">## P value adjustment: mvt method for 2 tests</span></span></code></pre>
<p>Note: When re-leveling to more than one factor, you have to be
careful to anticipate that the levels will be expanded using
<code><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid()</a></code>: the first factor in the list varies the
fastest and the last varies the slowest. That was the case in our
example, but in others, it may not be. Had the levels of
<code>treat</code> been ordered as
<code>A.L, A.M, A.H, B.L, B.M, B.H</code>, then we would have had to
specify the levels of <code>tension</code> first and the levels of
<code>wool</code> second.</p>
<p><a href="#contents">Back to contents</a></p>
<p><a href="vignette-topics.html">Index of all vignette topics</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Russell V. Lenth, Julia Piaskowski.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
